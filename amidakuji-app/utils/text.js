// amidakuji-app/utils/text.js

/**
 * 文字列を正規化する
 * - 前後の空白を削除
 * - 半角カナを全角カナに変換
 * - 全角英数字を半角英数字に変換
 * - 長音符やハイフンを統一
 * @param {string} str - 正規化する文字列
 * @returns {string} 正規化された文字列
 */
function normalizeName(str) {
  if (typeof str !== 'string') return '';

  let result = str.trim();

  // 半角カタカナを全角カタカナに変換
  result = result.replace(/[\uFF65-\uFF9F]/g, (match) => {
    const chars = {
      '･': '・', 'ｦ': 'ヲ', 'ｧ': 'ァ', 'ｨ': 'ィ', 'ｩ': 'ゥ', 'ｪ': 'ェ', 'ｫ': 'ォ',
      'ｬ': 'ャ', 'ｭ': 'ュ', 'ｮ': 'ョ', 'ｯ': 'ッ', 'ｰ': 'ー', 'ｱ': 'ア', 'ｲ': 'イ',
      'ｳ': 'ウ', 'ｴ': 'エ', 'ｵ': 'オ', 'ｶ': 'カ', 'ｷ': 'キ', 'ｸ': 'ク', 'ｹ': 'ケ',
      'ｺ': 'コ', 'ｻ': 'サ', 'ｼ': 'シ', 'ｽ': 'ス', 'ｾ': 'セ', 'ｿ': 'ソ', 'ﾀ': 'タ',
      'ﾁ': 'チ', 'ﾂ': 'ツ', 'ﾃ': 'テ', 'ﾄ': 'ト', 'ﾅ': 'ナ', 'ﾆ': 'ニ', 'ﾇ': 'ヌ',
      'ﾈ': 'ネ', 'ﾉ': 'ノ', 'ﾊ': 'ハ', 'ﾋ': 'ヒ', 'ﾌ': 'フ', 'ﾍ': 'ヘ', 'ﾎ': 'ホ',
      'ﾏ': 'マ', 'ﾐ': 'ミ', 'ﾑ': 'ム', 'ﾒ': 'メ', 'ﾓ': 'モ', 'ﾔ': 'ヤ', 'ﾕ': 'ユ',
      'ﾖ': 'ヨ', 'ﾗ': 'ラ', 'ﾘ': 'リ', 'ﾙ': 'ル', 'ﾚ': 'レ', 'ﾛ': 'ロ', 'ﾜ': 'ワ',
      'ﾝ': 'ン', 'ﾞ': '゛', 'ﾟ': '゜'
    };
    return chars[match] || match;
  });

  // 全角英数字を半角に変換
  result = result.replace(/[Ａ-Ｚａ-ｚ０-９]/g, (s) => {
    return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
  });

  // ハイフン・長音符を統一
  result = result.replace(/[‐—―-]/g, 'ー');

  return result;
}

module.exports = {
  normalizeName,
};