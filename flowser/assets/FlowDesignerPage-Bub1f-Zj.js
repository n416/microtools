import{n as e,t}from"./geminiApiClient-CXmDKArx.js";import{C as n,D as r,P as i,S as a,_t as o,mt as s,p as c,v as l,vt as u}from"./index-CFpdr6wi.js";var d=u(o()),f=u(s());function p(){let[o,s]=(0,d.useState)([]),[u,p]=(0,d.useState)(``),[m,h]=(0,d.useState)(``),[g,_]=(0,d.useState)([]),[v,y]=(0,d.useState)(!1),[b,x]=(0,d.useState)(``);return(0,d.useEffect)(()=>{let e=JSON.parse(localStorage.getItem(`knowledgeBase`))||[];s(e)},[]),(0,f.jsxs)(n,{sx:{display:`flex`,flexDirection:`column`,height:`100vh`,bgcolor:`background.default`},children:[(0,f.jsx)(n,{sx:{p:`0 24px`},children:(0,f.jsx)(e,{isLocked:!1})}),(0,f.jsx)(n,{sx:{flexGrow:1,p:`0 24px 24px 24px`,display:`flex`,gap:2,minHeight:0},children:(0,f.jsxs)(l,{container:!0,spacing:2,children:[(0,f.jsx)(l,{xs:12,md:5,children:(0,f.jsxs)(i,{sx:{p:2,height:`100%`,display:`flex`,flexDirection:`column`},children:[(0,f.jsx)(r,{variant:`h6`,gutterBottom:!0,children:`① 知識ベース`}),(0,f.jsx)(c,{label:`新しい知識`,multiline:!0,rows:4,variant:`outlined`,fullWidth:!0,value:u,onChange:e=>p(e.target.value),placeholder:`例: 普通自動車の契約には印鑑証明書が必要`,sx:{mb:1}}),(0,f.jsx)(a,{variant:`contained`,onClick:()=>{if(u.trim()){let e=o.length>0?Math.max(...o.map(e=>parseInt(e.id.substring(1))))+1:1,t={id:`K${String(e).padStart(3,`0`)}`,text:u.trim()},n=[...o,t];s(n),localStorage.setItem(`knowledgeBase`,JSON.stringify(n)),p(``)}},sx:{mb:2},children:`知識を登録`}),(0,f.jsx)(n,{sx:{overflow:`auto`,flexGrow:1},children:o.map(e=>(0,f.jsxs)(i,{variant:`outlined`,sx:{p:1,mb:1},children:[(0,f.jsx)(r,{variant:`caption`,children:e.id}),(0,f.jsx)(r,{variant:`body2`,children:e.text})]},e.id))})]})}),(0,f.jsx)(l,{xs:12,md:7,children:(0,f.jsxs)(i,{sx:{p:2,height:`100%`,display:`flex`,flexDirection:`column`},children:[(0,f.jsx)(r,{variant:`h6`,gutterBottom:!0,children:`② フロー生成`}),(0,f.jsx)(c,{label:`AIへの指示`,multiline:!0,rows:4,variant:`outlined`,fullWidth:!0,value:m,onChange:e=>h(e.target.value),placeholder:`例: 軽自動車の新規契約で、値引き交渉があった場合のフロー`,sx:{mb:1}}),(0,f.jsx)(a,{variant:`contained`,color:`primary`,onClick:async()=>{if(!m.trim()||o.length===0){alert(`「知識ベース」と「AIへの指示」の両方を入力してください。`);return}y(!0),_([]);try{let e=new t;if(!e.isAvailable)throw Error(`APIキーと使用モデルが未設定です。右上の設定アイコンから登録・選択してください。`);let n=`あなたは優秀な業務コンサルタントです。以下の【知識リスト】を制約条件として厳守し、ユーザーからの【指示】に合致する業務フローを、論理的に矛盾のないステップ・バイ・ステップのリスト形式で提案してください。各ステップがどの知識に基づいているか、IDを明記してください。\n\n【知識リスト】\n${o.map(e=>`${e.id}: ${e.text}`).join(`
`)}\n\n【指示】\n${m}\n\n【出力形式】\n- (タスク内容1) (根拠: KXXX)\n- (タスク内容2) (根拠: KXXX)\n- (AIが補完したタスク内容)`,r=(await e.generateContent(n)).split(`
`).filter(e=>e.trim().startsWith(`-`)).map((e,t)=>{let n=e.match(/- (.+?) \(根拠: (K\d+)\)/);return{id:t+1,text:n?n[1].trim():e.replace(`-`,``).trim(),refId:n?n[2].trim():`AI`,completed:!1,details:``}});_(r)}catch(e){console.error(`API呼び出し中にエラーが発生しました:`,e),alert(`エラー: ${e.message}`)}finally{y(!1)}},disabled:v,children:v?`生成中...`:`フローを生成`}),(0,f.jsx)(n,{sx:{overflow:`auto`,flexGrow:1,my:2,p:1,border:`1px solid #eee`,borderRadius:1},children:g.map(e=>(0,f.jsxs)(i,{variant:`outlined`,sx:{p:1,mb:1,display:`flex`,alignItems:`center`,gap:1},children:[(0,f.jsx)(r,{variant:`caption`,sx:{bgcolor:`grey.200`,p:`2px 8px`,borderRadius:`12px`},children:e.refId}),(0,f.jsx)(r,{variant:`body2`,children:e.text})]},e.id))}),(0,f.jsxs)(n,{sx:{display:`flex`,gap:2},children:[(0,f.jsx)(c,{label:`新しいフロー名`,variant:`outlined`,fullWidth:!0,value:b,onChange:e=>x(e.target.value)}),(0,f.jsx)(a,{variant:`contained`,color:`success`,onClick:()=>{if(!b.trim()){alert(`フロー名を入力してください。`);return}if(g.length===0){alert(`保存するタスクがありません。`);return}let e=JSON.parse(localStorage.getItem(`workflowLibrary`))||[],t={id:`wf${Date.now()}`,name:b.trim(),description:`AIによって「${m.substring(0,20)}...」という指示を元に生成されました。`,tasks:g};e.push(t),localStorage.setItem(`workflowLibrary`,JSON.stringify(e)),alert(`新しいフローが保存されました！顧客管理画面で利用できます。`),x(``),h(``),_([])},children:`このフローを保存`})]})]})})]})})]})}var m=p;export{m as default};