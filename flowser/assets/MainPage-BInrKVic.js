import{a as e,i as t,n,r,t as i}from"./AutoFixHigh-CeutuXMh.js";import{C as a,D as o,N as s,S as c,T as l,_ as u,a as d,g as f,i as p,k as m,l as h,m as g,r as _,t as v,u as y,z as b}from"./Header-CUnFWtwv.js";import{i as x,n as S,t as C}from"./geminiApiClient-niiFFWIv.js";import{n as w,t as T}from"./ListItemText-D75Fq_kV.js";import{A as E,Bt as D,C as O,D as k,Dt as A,E as j,It as M,J as N,K as ee,L as P,M as te,N as ne,O as re,P as ie,Q as F,T as ae,X as I,Z as L,_t as R,ct as z,gt as B,ht as V,j as H,k as oe,nt as U,q as se,rt as ce,tt as W,w as le}from"./index-D9m0Yf2z.js";var G=D(M()),K=D(A()),ue=b((0,K.jsx)(`path`,{d:`M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z`}),`CheckBoxOutlineBlank`),de=b((0,K.jsx)(`path`,{d:`M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z`}),`CheckBox`),fe=b((0,K.jsx)(`path`,{d:`M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z`}),`IndeterminateCheckBox`);function pe(e){return B(`MuiCheckbox`,e)}var q=V(`MuiCheckbox`,[`root`,`checked`,`disabled`,`indeterminate`,`colorPrimary`,`colorSecondary`,`sizeSmall`,`sizeMedium`]),me=e=>{let{classes:t,indeterminate:n,color:r,size:i}=e,a={root:[`root`,n&&`indeterminate`,`color${W(r)}`,`size${W(i)}`]},o=z(a,pe,t);return{...t,...o}},J=U(x,{shouldForwardProp:e=>ce(e)||e===`classes`,name:`MuiCheckbox`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.indeterminate&&t.indeterminate,t[`size${W(n.size)}`],n.color!==`default`&&t[`color${W(n.color)}`]]}})(F(({theme:e})=>({color:(e.vars||e).palette.text.secondary,variants:[{props:{color:`default`,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.active,(e.vars||e).palette.action.hoverOpacity)}}},...Object.entries(e.palette).filter(I()).map(([t])=>({props:{color:t,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.hoverOpacity)}}})),...Object.entries(e.palette).filter(I()).map(([t])=>({props:{color:t},style:{[`&.${q.checked}, &.${q.indeterminate}`]:{color:(e.vars||e).palette[t].main},[`&.${q.disabled}`]:{color:(e.vars||e).palette.action.disabled}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:`transparent`}}}}]}))),he=(0,K.jsx)(de,{}),ge=(0,K.jsx)(ue,{}),_e=(0,K.jsx)(fe,{}),Y=G.forwardRef(function(e,t){let n=L({props:e,name:`MuiCheckbox`}),{checkedIcon:r=he,color:i=`primary`,icon:a=ge,indeterminate:c=!1,indeterminateIcon:l=_e,inputProps:u,size:d=`medium`,disableRipple:f=!1,className:p,slots:m={},slotProps:h={},...g}=n,_=c?l:a,v=c?l:r,y={...n,disableRipple:f,color:i,indeterminate:c,size:d},b=me(y),x=h.input??u,[S,C]=o(`root`,{ref:t,elementType:J,className:R(b.root,p),shouldForwardComponentProp:!0,externalForwardedProps:{slots:m,slotProps:h,...g},ownerState:y,additionalProps:{type:`checkbox`,icon:G.cloneElement(_,{fontSize:_.props.fontSize??d}),checkedIcon:G.cloneElement(v,{fontSize:v.props.fontSize??d}),disableRipple:f,slots:m,slotProps:{input:s(typeof x==`function`?x(y):x,{"data-indeterminate":c})}}});return(0,K.jsx)(S,{...C,classes:b})}),ve=e=>{let{alignItems:t,classes:n}=e;return z({root:[`root`,t===`flex-start`&&`alignItemsFlexStart`]},S,n)},ye=U(`div`,{name:`MuiListItemIcon`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.alignItems===`flex-start`&&t.alignItemsFlexStart]}})(F(({theme:e})=>({minWidth:56,color:(e.vars||e).palette.action.active,flexShrink:0,display:`inline-flex`,variants:[{props:{alignItems:`flex-start`},style:{marginTop:8}}]}))),X=G.forwardRef(function(e,t){let n=L({props:e,name:`MuiListItemIcon`}),{className:r,...i}=n,a=G.useContext(y),o={...n,alignItems:a.alignItems},s=ve(o);return(0,K.jsx)(ye,{className:R(s.root,r),ownerState:o,ref:t,...i})}),be=U(m)({padding:`16px`,height:`100%`,overflow:`auto`}),Z={critical:{label:`è¦å¯¾å¿œ`,color:`error`},progress:{label:`å¯¾å¿œä¸­`,color:`warning`},success:{label:`å®Œäº†`,color:`success`},new:{label:`æ–°è¦`,color:`default`}};function xe({customers:e,selectedCustomerId:n,onSelectCustomer:r}){return(0,K.jsxs)(be,{children:[(0,K.jsx)(a,{variant:`h6`,gutterBottom:!0,children:`é¡§å®¢ãƒªã‚¹ãƒˆ`}),(0,K.jsx)(h,{children:e.map(e=>(0,K.jsxs)(t,{selected:n===e.id,onClick:()=>r(e.id),children:[(0,K.jsx)(T,{primary:e.name,secondary:e.company}),Z[e.status]&&(0,K.jsx)(c,{label:Z[e.status].label,color:Z[e.status].color,size:`small`})]},e.id))})]})}var Se=xe,Ce=b((0,K.jsx)(`path`,{d:`M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z`}),`KeyboardArrowUp`),we=b((0,K.jsx)(`path`,{d:`M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z`}),`KeyboardArrowDown`),Te=U(m)({padding:`16px`,flexShrink:0}),Q={critical:{label:`è¦å¯¾å¿œ`,color:`error`},progress:{label:`å¯¾å¿œä¸­`,color:`warning`},success:{label:`å®Œäº†`,color:`success`},new:{label:`æ–°è¦`,color:`default`}};function Ee({customer:e,assignedCases:t,onUnassignCase:n,onOpenModal:r}){let[i,o]=(0,G.useState)(!1);return e?(0,K.jsxs)(Te,{children:[(0,K.jsxs)(N,{sx:{display:`flex`,justifyContent:`space-between`,alignItems:`center`},children:[(0,K.jsx)(a,{variant:`h6`,children:`é¡§å®¢è©³ç´°`}),(0,K.jsx)(l,{onClick:()=>o(!i),size:`small`,children:i?(0,K.jsx)(we,{}):(0,K.jsx)(Ce,{})})]}),!i&&(0,K.jsxs)(N,{sx:{mt:1},children:[(0,K.jsx)(a,{variant:`h5`,children:e.name}),(0,K.jsx)(a,{variant:`body1`,children:e.company}),Q[e.status]&&(0,K.jsx)(c,{label:Q[e.status].label,color:Q[e.status].color,sx:{mt:1}}),(0,K.jsx)(g,{sx:{my:2}}),(0,K.jsx)(a,{variant:`subtitle2`,gutterBottom:!0,children:`å‰²ã‚Šå½“ã¦æ¸ˆã¿ã‚±ãƒ¼ã‚¹`}),(0,K.jsx)(N,{sx:{display:`flex`,flexWrap:`wrap`,gap:1,mb:2},children:t&&t.length>0?t.map(e=>(0,K.jsx)(c,{label:e.name,onDelete:()=>n(e.instanceId),color:`primary`,variant:`outlined`},e.instanceId)):(0,K.jsx)(a,{variant:`body2`,color:`text.secondary`,children:`(ãªã—)`})}),(0,K.jsx)(u,{variant:`contained`,onClick:r,children:`ã‚±ãƒ¼ã‚¹ã‚’å‰²ã‚Šå½“ã¦`})]})]}):(0,K.jsx)(Te,{children:(0,K.jsx)(a,{children:`é¡§å®¢ã‚’é¸æŠžã—ã¦ãã ã•ã„`})})}var De=Ee,Oe=b((0,K.jsx)(`path`,{d:`M2 12.5C2 9.46 4.46 7 7.5 7H18c2.21 0 4 1.79 4 4s-1.79 4-4 4H9.5C8.12 15 7 13.88 7 12.5S8.12 10 9.5 10H17v2H9.41c-.55 0-.55 1 0 1H18c1.1 0 2-.9 2-2s-.9-2-2-2H7.5C5.57 9 4 10.57 4 12.5S5.57 16 7.5 16H17v2H7.5C4.46 18 2 15.54 2 12.5`}),`Attachment`),ke=b((0,K.jsx)(`path`,{d:`m19 15-6 6-1.42-1.42L15.17 16H4V4h2v10h9.17l-3.59-3.58L13 9z`}),`SubdirectoryArrowRight`),Ae=b([(0,K.jsx)(`path`,{d:`M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7-.25c.41 0 .75.34.75.75s-.34.75-.75.75-.75-.34-.75-.75.34-.75.75-.75M19 19H5V5h14z`},`0`),(0,K.jsx)(`path`,{d:`m15.08 11.03-2.12-2.12L7 14.86V17h2.1zm1.77-1.76c.2-.2.2-.51 0-.71l-1.41-1.41c-.2-.2-.51-.2-.71 0l-1.06 1.06 2.12 2.12z`},`1`)],`NoteAltOutlined`),je=U(m)({padding:`16px`,display:`flex`,flexDirection:`column`,flexGrow:1,minHeight:0}),Me=U(`div`)({width:`28px`,height:`28px`,borderRadius:`50%`,border:`2px solid #e53935`,color:`#e53935`,display:`flex`,alignItems:`center`,justifyContent:`center`,fontWeight:`bold`,fontSize:`14px`,transform:`rotate(-10deg)`,fontFamily:`"Helvetica Neue", Arial, sans-serif`}),Ne=e=>e.type===`nested_branch`?e.selectedOption?e.options[e.selectedOption].tasks.every(e=>Ne(e)):!1:e.completed,Pe=({task:e,selectedTaskId:r,onSelectTask:i,level:a=0})=>{let o=Ne(e);return(0,K.jsxs)(G.Fragment,{children:[(0,K.jsx)(w,{disablePadding:!0,sx:{pl:a*2},children:(0,K.jsxs)(t,{selected:r===e.id,onClick:()=>i(e.id),sx:{p:`4px 8px`},children:[(0,K.jsxs)(X,{sx:{minWidth:40,height:28,alignItems:`center`,justifyContent:`center`},children:[a>0&&(0,K.jsx)(ke,{fontSize:`small`,color:`action`,sx:{mr:1}}),o?(0,K.jsx)(Me,{children:`æ¸ˆ`}):(0,K.jsx)(N,{sx:{width:28}})]}),(0,K.jsx)(T,{primary:e.text}),e.type===`nested_branch`&&(0,K.jsx)(X,{sx:{minWidth:`auto`,mr:1,color:`text.secondary`},children:(0,K.jsx)(n,{fontSize:`small`})}),e.type===`nested_branch`&&e.selectedOption&&(0,K.jsx)(c,{label:e.options[e.selectedOption].label,size:`small`,variant:`outlined`,sx:{mr:1}}),e.memo&&(0,K.jsx)(X,{sx:{minWidth:`auto`,mr:1},children:(0,K.jsx)(Ae,{fontSize:`small`,color:`action`})}),e.documents&&e.documents.length>0&&(0,K.jsx)(X,{sx:{minWidth:`auto`},children:(0,K.jsx)(Oe,{fontSize:`small`,color:`action`})})]})},e.id),e.type===`nested_branch`&&e.selectedOption&&e.options[e.selectedOption]&&e.options[e.selectedOption].tasks.map(e=>(0,K.jsx)(Pe,{task:e,selectedTaskId:r,onSelectTask:i,level:a+1},e.id))]})};function Fe({assignedCases:e,selectedCaseId:t,onSelectCase:n,currentCase:r,onSelectTask:i,selectedTaskId:o}){return!e||e.length===0?(0,K.jsxs)(je,{children:[(0,K.jsx)(a,{variant:`h6`,gutterBottom:!0,children:`ðŸ¤– å®Ÿè¡Œä¸­ã‚±ãƒ¼ã‚¹`}),(0,K.jsx)(N,{sx:{display:`flex`,alignItems:`center`,justifyContent:`center`,height:`100%`},children:(0,K.jsx)(a,{variant:`body2`,color:`text.secondary`,children:`ã“ã®é¡§å®¢ã«ã¯å®Ÿè¡Œä¸­ã®ã‚±ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã›ã‚“ã€‚`})})]}):(0,K.jsxs)(je,{children:[(0,K.jsx)(a,{variant:`h6`,gutterBottom:!0,children:`ðŸ¤– å®Ÿè¡Œä¸­ã‚±ãƒ¼ã‚¹`}),(0,K.jsx)(N,{sx:{borderBottom:1,borderColor:`divider`,mb:1},children:(0,K.jsx)(p,{value:t||!1,onChange:(e,t)=>{n(t)},variant:`scrollable`,scrollButtons:`auto`,children:e.map(e=>(0,K.jsx)(d,{label:e.name,value:e.instanceId},e.instanceId))})}),(0,K.jsx)(N,{sx:{overflow:`auto`,flexGrow:1},children:r?(0,K.jsx)(h,{dense:!0,children:r.tasks.map(e=>(0,K.jsx)(Pe,{task:e,selectedTaskId:o,onSelectTask:i},e.id))}):(0,K.jsx)(N,{sx:{display:`flex`,alignItems:`center`,justifyContent:`center`,height:`100%`},children:(0,K.jsx)(a,{variant:`body2`,color:`text.secondary`,children:`ã‚±ãƒ¼ã‚¹ã‚’é¸æŠžã—ã¦ãã ã•ã„ã€‚`})})})]})}var Ie=Fe,Le=b((0,K.jsx)(`path`,{d:`M18 15v3H6v-3H4v3c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-3zm-1-4-1.41-1.41L13 12.17V4h-2v8.17L8.41 9.59 7 11l5 5z`}),`FileDownloadOutlined`),Re=U(m)({padding:`16px`,height:`100%`,display:`flex`,flexDirection:`column`}),ze=(e,t)=>{let n=(e,t)=>{for(let r=0;r<e.length;r++){let i=e[r];if(i.id===t)return r===e.length-1;if(i.type===`nested_branch`&&i.selectedOption){let e=i.options[i.selectedOption].tasks||[],r=n(e,t);if(r!==null)return r}}return null};return n(t,e.id)};function Be({task:n,currentCase:o,flowLibrary:s,onToggleDocument:c,onToggleTask:d,onSelectBranch:f,onUpdateTaskMemo:p,onConcludeAndProceed:m}){let v=ee(),[y,b]=(0,G.useState)(``),[x,S]=(0,G.useState)(!1),[E,D]=(0,G.useState)(!1),{isApiCommunicating:O,selectedCustomerId:A,selectedCaseId:j}=se(e=>e.case);(0,G.useEffect)(()=>{n&&b(n.memo||``);let e=new C;S(e.isAvailable)},[n]);let M=(0,G.useMemo)(()=>!n||!o||!o.tasks?!1:ze(n,o.tasks),[n,o]),P=(0,G.useMemo)(()=>!o||!s?null:s.find(e=>e.id===o.templateId)?.joint||null,[o,s]);return n?(0,K.jsxs)(Re,{children:[(0,K.jsxs)(N,{children:[(0,K.jsx)(a,{variant:`h6`,children:n.text}),(0,K.jsx)(g,{sx:{my:1}}),n.type===`nested_branch`?(0,K.jsx)(N,{children:(0,K.jsxs)(r,{spacing:1,children:[(0,K.jsx)(a,{variant:`subtitle2`,children:`ãƒ—ãƒ©ãƒ³ã‚’é¸æŠžã—ã¦ãã ã•ã„:`}),Object.entries(n.options).map(([e,t])=>(0,K.jsx)(u,{variant:n.selectedOption===e?`contained`:`outlined`,onClick:()=>f(e),children:t.label},e))]})}):(0,K.jsxs)(t,{onClick:d,sx:{borderRadius:1,p:`4px 8px`},children:[(0,K.jsx)(X,{sx:{minWidth:40},children:(0,K.jsx)(Y,{edge:`start`,checked:!!n.completed,tabIndex:-1,disableRipple:!0})}),(0,K.jsx)(T,{primary:`ã“ã®ã‚¿ã‚¹ã‚¯ã‚’å®Œäº†æ¸ˆã¿ã«ã™ã‚‹`})]})]}),(0,K.jsx)(g,{sx:{my:1}}),(0,K.jsxs)(N,{sx:{overflow:`auto`,flexGrow:1},children:[(0,K.jsx)(a,{variant:`body1`,sx:{my:2,whiteSpace:`pre-wrap`},children:n.details}),(0,K.jsxs)(N,{sx:{my:2},children:[(0,K.jsxs)(N,{sx:{display:`flex`,justifyContent:`space-between`,alignItems:`center`,mb:1},children:[(0,K.jsx)(a,{variant:`subtitle2`,gutterBottom:!0,sx:{mb:0},children:`ðŸ“ ã‚¿ã‚¹ã‚¯ãƒ¡ãƒ¢`}),x&&(0,K.jsx)(u,{size:`small`,variant:`outlined`,startIcon:(0,K.jsx)(i,{}),onClick:async()=>{if(!n||!y.trim()){alert(`ãƒ¡ãƒ¢å†…å®¹ãŒç©ºã§ã™ã€‚`);return}D(!0),v(k(!0));try{let e=new C,t=`ã‚ãªãŸã¯å„ªç§€ãªã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ä»¥ä¸‹ã®ã‚¿ã‚¹ã‚¯å†…å®¹ã‚’è¸ã¾ãˆã€ãƒ¡ãƒ¢ã®å†…å®¹ã‚’ã‚ˆã‚Šåˆ†ã‹ã‚Šã‚„ã™ãã€ç°¡æ½”ã«ã€ã‹ã¤ä¸å¯§ãªè¨€è‘‰é£ã„ã«ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚\n\n# ã‚¿ã‚¹ã‚¯å†…å®¹\n${n.text}\n\n# ãƒ¡ãƒ¢ã®åŽŸæ–‡\n${y}\n\n# æŒ‡ç¤º\n- ä¿®æ­£å¾Œã®ãƒ¡ãƒ¢ã®ãƒ†ã‚­ã‚¹ãƒˆã ã‘ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚\n- æŒ¨æ‹¶ã‚„å‰ç½®ãã€ã€Œä¿®æ­£å¾Œã®ãƒ¡ãƒ¢:ã€ã¨ã„ã£ãŸè¦‹å‡ºã—ã€markdownã®è£…é£¾ãªã©ã¯ä¸€åˆ‡å«ã‚ãªã„ã§ãã ã•ã„ã€‚`,r=await e.generateContent(t);v(H({task:n,customerId:A,caseInstanceId:j,originalMemo:y,suggestion:r.trim()}))}catch(e){console.error(`AI memo refinement failed:`,e),alert(`AIã«ã‚ˆã‚‹æ•´å½¢ã«å¤±æ•—ã—ã¾ã—ãŸ: ${e.message}`),v(k(!1))}finally{D(!1)}},disabled:E||O,children:E||O?`å‡¦ç†ä¸­...`:`AIæ•´å½¢`})]}),(0,K.jsx)(_,{fullWidth:!0,multiline:!0,rows:4,variant:`outlined`,placeholder:`ã“ã®ã‚¿ã‚¹ã‚¯ã«é–¢ã™ã‚‹ãƒ¡ãƒ¢ã‚’å…¥åŠ›...`,value:y,onChange:e=>b(e.target.value),onBlur:()=>{n&&n.memo!==y&&p(y)}})]}),n.documents&&n.documents.length>0&&(0,K.jsxs)(N,{sx:{mt:2},children:[(0,K.jsx)(a,{variant:`subtitle2`,gutterBottom:!0,children:`é–¢é€£æ›¸é¡ž`}),(0,K.jsx)(h,{dense:!0,children:n.documents.map(e=>(0,K.jsx)(w,{disablePadding:!0,secondaryAction:(0,K.jsx)(l,{edge:`end`,href:e.url,target:`_blank`,sx:{right:`8px`},children:(0,K.jsx)(Le,{})}),children:(0,K.jsxs)(t,{onClick:()=>c&&c(e.name),sx:{pr:`48px`},children:[(0,K.jsx)(X,{children:(0,K.jsx)(Y,{edge:`start`,checked:e.checked,tabIndex:-1,disableRipple:!0})}),(0,K.jsx)(T,{primary:e.name})]})},e.name))})]})]}),(()=>{if(!n?.completed||!M||!P)return null;if(P.type===`direct`&&P.nextFlowId){let t=s.find(e=>e.id===P.nextFlowId);return(0,K.jsxs)(N,{sx:{mt:2},children:[(0,K.jsx)(e,{severity:`info`,sx:{mb:1},children:`ã“ã®ã‚±ãƒ¼ã‚¹ã¯å®Œäº†ã—ã¾ã—ãŸã€‚æ¬¡ã®ãƒ—ãƒ­ã‚»ã‚¹ã«é€²ã‚“ã§ãã ã•ã„ã€‚`}),(0,K.jsxs)(u,{variant:`contained`,fullWidth:!0,onClick:()=>m(P.nextFlowId),children:[`ã€Œ`,t?t.name:`æ¬¡ã®ãƒ•ãƒ­ãƒ¼`,`ã€ã¸é€²ã‚€`]})]})}return P.type===`branching`&&P.branches?.length>0?(0,K.jsxs)(N,{sx:{mt:2},children:[(0,K.jsx)(e,{severity:`info`,sx:{mb:2},children:P.prompt||`æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é¸æŠžã—ã¦ãã ã•ã„ã€‚`}),(0,K.jsx)(r,{spacing:1,children:P.branches.map(e=>!e.nextFlowId||!e.label?null:(0,K.jsx)(u,{variant:`outlined`,onClick:()=>m(e.nextFlowId),children:e.label},e.id))})]}):null})()]}):(0,K.jsx)(Re,{children:(0,K.jsx)(N,{sx:{display:`flex`,alignItems:`center`,justifyContent:`center`,height:`100%`},children:(0,K.jsx)(a,{variant:`body2`,color:`text.secondary`,children:`ä¸­å¤®ã®ãƒªã‚¹ãƒˆã‹ã‚‰ã‚¿ã‚¹ã‚¯ã‚’é¸æŠžã—ã¦ãã ã•ã„ã€‚`})})})}var Ve=Be,He=b((0,K.jsx)(`path`,{d:`M22 3H7c-.69 0-1.23.35-1.59.88L0 12l5.41 8.11c.36.53.9.89 1.59.89h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H7.07L2.4 12l4.66-7H22zm-11.59-2L14 13.41 17.59 17 19 15.59 15.41 12 19 8.41 17.59 7 14 10.59 10.41 7 9 8.41 12.59 12 9 15.59z`}),`BackspaceOutlined`),Ue=b((0,K.jsx)(`path`,{d:`M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z`}),`Clear`),$={position:`absolute`,top:`50%`,left:`50%`,transform:`translate(-50%, -50%)`,width:600,bgcolor:`background.paper`,border:`2px solid #000`,boxShadow:24,p:4},We={position:`absolute`,top:`50%`,left:`50%`,transform:`translate(-50%, -50%)`},Ge=`1234`;function Ke(){let e=ee(),{customerData:n,flowLibrary:i,selectedCustomerId:o,selectedCaseId:s,selectedTaskId:c}=se(e=>e.case),[l,d]=(0,G.useState)(!1),[p,g]=(0,G.useState)(()=>JSON.parse(localStorage.getItem(`isCustomerListLocked`))||!1),[_,y]=(0,G.useState)(!1),[b,x]=(0,G.useState)(!1),[S,C]=(0,G.useState)(``),[w,D]=(0,G.useState)(!1),[k,A]=(0,G.useState)(null),[M,F]=(0,G.useState)(!1),[I,L]=(0,G.useState)(null);(0,G.useEffect)(()=>{localStorage.setItem(`isCustomerListLocked`,JSON.stringify(p))},[p]);let R=(0,G.useCallback)(()=>{JSON.parse(localStorage.getItem(`securityMode`))&&document.visibilityState===`hidden`&&!p&&g(!0)},[p]);(0,G.useEffect)(()=>(document.addEventListener(`visibilitychange`,R),()=>document.removeEventListener(`visibilitychange`,R)),[R]);let z=(0,G.useMemo)(()=>n.find(e=>e.id===o),[n,o]),B=(0,G.useMemo)(()=>z?.assignedCases||[],[z]),V=(0,G.useMemo)(()=>!B||B.length===0?null:B.some(e=>e.instanceId===s)?s:B.find(e=>e.status!==`completed`)?.instanceId||null,[B,s]);(0,G.useEffect)(()=>{V!==s&&e(re(V))},[V,s,e]);let H=(0,G.useMemo)(()=>B.find(e=>e.instanceId===V),[B,V]);(0,G.useEffect)(()=>{if(H&&H.tasks.length>0){let t=(e,n)=>{for(let r of e)if(r.id===n||r.type===`nested_branch`&&r.selectedOption&&r.options[r.selectedOption]&&t(r.options[r.selectedOption].tasks,n))return!0;return!1};if(!(c&&t(H.tasks,c))){let t=H.tasks[0];t&&e(E(t.id))}}else c!==null&&e(E(null))},[H,c,e]);let U=(0,G.useMemo)(()=>{if(!c||!H)return null;let e=(t,n)=>{for(let r of t){if(r.id===n)return r;if(r.type===`nested_branch`&&r.selectedOption&&r.options[r.selectedOption]){let t=e(r.options[r.selectedOption].tasks||[],n);if(t)return t}}return null};return e(H.tasks,c)},[c,H]),ce=t=>{e(O({customerId:o,flowTemplateId:t})),d(!1)},W=t=>{e(ie({customerId:o,caseInstanceId:t}))},ue=(t,n)=>{e(P({customerId:o,caseInstanceId:V,taskId:t,memo:n}))},de=t=>{e(ne({customerId:o,caseInstanceId:V,taskId:t}))},fe=(t,n)=>{e(te({customerId:o,caseInstanceId:V,taskId:t,docName:n}))},pe=(t,n)=>{let r=localStorage.getItem(`branchResetBehavior`)||`confirm`;if(!H)return;let i=null,a=(e,t)=>{for(let n of e){if(n.id===t)return n;if(n.type===`nested_branch`&&n.options)for(let e in n.options){let r=a(n.options[e].tasks||[],t);if(r)return r}}return null};if(i=a(H.tasks,t),!i)return;if(!(i.selectedOption&&i.selectedOption!==n)){e(j({customerId:o,caseInstanceId:V,taskId:t,optionKey:n,shouldReset:!1}));return}let s=i.selectedOption,c=s&&i.options[s]?.tasks||[],l=e=>{for(let t of e)if(t.completed||t.type===`nested_branch`&&t.selectedOption&&l(t.options[t.selectedOption].tasks||[]))return!0;return!1};if(!l(c)||r===`keep`){e(j({customerId:o,caseInstanceId:V,taskId:t,optionKey:n,shouldReset:!1}));return}if(r===`clear`){e(j({customerId:o,caseInstanceId:V,taskId:t,optionKey:n,shouldReset:!0}));return}A({taskId:t,newOptionKey:n}),D(!0)},q=t=>{if(k){let{taskId:n,newOptionKey:r}=k;e(j({customerId:o,caseInstanceId:V,taskId:n,optionKey:r,shouldReset:t}))}D(!1),A(null)},me=t=>{B.some(e=>e.templateId===t)?(L({nextFlowId:t}),F(!0)):e(le({customerId:o,caseInstanceId:V,nextFlowId:t}))},J=t=>{I&&e(t?le({customerId:o,caseInstanceId:V,nextFlowId:I.nextFlowId}):ae({customerId:o,caseInstanceId:V})),F(!1),L(null)},he=()=>{p?(C(``),x(!0)):y(!0)},ge=()=>{g(!0),y(!1)},_e=e=>C(t=>t+e),Y=()=>C(e=>e.slice(0,-1)),ve=()=>C(``);(0,G.useEffect)(()=>{S===Ge&&(g(!1),x(!1),C(``))},[S]);let ye=[{type:`num`,value:1},{type:`num`,value:2},{type:`num`,value:3},{type:`num`,value:4},{type:`num`,value:5},{type:`num`,value:6},{type:`num`,value:7},{type:`num`,value:8},{type:`num`,value:9},{type:`clear`,value:(0,K.jsx)(Ue,{})},{type:`num`,value:0},{type:`bs`,value:(0,K.jsx)(He,{})}];return(0,K.jsxs)(N,{sx:{display:`flex`,flexDirection:`column`,height:`100vh`,bgcolor:`background.default`},children:[(0,K.jsx)(N,{sx:{p:`0 24px`},children:(0,K.jsx)(v,{isLocked:p,onToggleLock:he})}),(0,K.jsxs)(N,{sx:{flexGrow:1,p:`0 24px 24px 24px`,display:`flex`,gap:2,minHeight:0},children:[!p&&(0,K.jsx)(N,{sx:{flex:`0 1 320px`,minWidth:280,transition:`all 0.3s ease`},children:(0,K.jsx)(Se,{customers:n,selectedCustomerId:o,onSelectCustomer:t=>e(oe(t))})}),(0,K.jsxs)(N,{sx:{flex:`1 1 50%`,display:`flex`,flexDirection:`column`,gap:2,minHeight:`fit-content`,minWidth:400},children:[(0,K.jsx)(De,{customer:z,assignedCases:B,onUnassignCase:W,onOpenModal:()=>d(!0)}),(0,K.jsx)(Ie,{assignedCases:B,selectedCaseId:V,onSelectCase:t=>e(re(t)),currentCase:H,onSelectTask:t=>e(E(t)),selectedTaskId:c})]}),(0,K.jsx)(N,{sx:{flex:`0 1 35%`,minWidth:320},children:(0,K.jsx)(Ve,{task:U,currentCase:H,flowLibrary:i,onUpdateTaskMemo:e=>U&&ue(U.id,e),onToggleTask:()=>U&&de(U.id),onSelectBranch:e=>U&&pe(U.id,e),onToggleDocument:e=>U&&fe(U.id,e),onConcludeAndProceed:me},U?`${V}-${c}`:`no-task-selected`)})]}),(0,K.jsx)(f,{open:l,onClose:()=>d(!1),children:(0,K.jsxs)(N,{sx:$,children:[(0,K.jsx)(a,{variant:`h6`,component:`h2`,gutterBottom:!0,children:`ãƒ•ãƒ­ãƒ¼ã‚’é¸æŠž`}),(0,K.jsx)(h,{children:i.map(e=>(0,K.jsx)(t,{onClick:()=>ce(e.id),disabled:B.some(t=>t.templateId===e.id),children:(0,K.jsx)(T,{primary:e.name,secondary:e.description})},e.id))})]})}),(0,K.jsx)(f,{open:_,onClose:()=>y(!1),children:(0,K.jsxs)(N,{sx:$,style:{width:400},children:[(0,K.jsx)(a,{variant:`h6`,component:`h2`,children:`é¡§å®¢ãƒªã‚¹ãƒˆã‚’ãƒ­ãƒƒã‚¯ã—ã¾ã™ã‹ï¼Ÿ`}),(0,K.jsx)(a,{sx:{mt:2},children:`ãƒ­ãƒƒã‚¯ã™ã‚‹ã¨ã€ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹ã¾ã§ãƒªã‚¹ãƒˆã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚`}),(0,K.jsxs)(N,{sx:{mt:3,display:`flex`,justifyContent:`flex-end`,gap:1},children:[(0,K.jsx)(u,{variant:`outlined`,onClick:()=>y(!1),children:`ã‚­ãƒ£ãƒ³ã‚»ãƒ«`}),(0,K.jsx)(u,{variant:`contained`,color:`primary`,onClick:ge,children:`ãƒªã‚¹ãƒˆã‚’ãƒ­ãƒƒã‚¯`})]})]})}),(0,K.jsx)(f,{open:M,onClose:()=>F(!1),children:(0,K.jsxs)(N,{sx:{...$,width:500},children:[(0,K.jsx)(a,{variant:`h6`,children:`ãƒ—ãƒ­ã‚»ã‚¹ã®ç¹°ã‚Šè¿”ã—ç¢ºèª`}),(0,K.jsx)(a,{sx:{mt:2},children:`ã“ã®æ“ä½œã«ã‚ˆã‚Šã€ä»¥å‰ã«å®Ÿè¡Œã—ãŸã“ã¨ã®ã‚ã‚‹æ¥­å‹™ãƒ—ãƒ­ã‚»ã‚¹ãŒå†åº¦é–‹å§‹ã•ã‚Œã¾ã™ã€‚ ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¹°ã‚Šè¿”ã—ã¾ã™ã‹ï¼Ÿãã‚Œã¨ã‚‚ã“ã“ã§å…¨ã¦ã®æ¥­å‹™ã‚’å®Œäº†ã—ã¾ã™ã‹ï¼Ÿ`}),(0,K.jsxs)(N,{sx:{mt:3,display:`flex`,justifyContent:`flex-end`,gap:1},children:[(0,K.jsx)(u,{variant:`contained`,color:`primary`,onClick:()=>J(!0),children:`ç¹°ã‚Šè¿”ã™`}),(0,K.jsx)(u,{variant:`outlined`,onClick:()=>J(!1),children:`å®Œäº†ã™ã‚‹`})]})]})}),(0,K.jsx)(f,{open:w,onClose:()=>{D(!1),A(null)},children:(0,K.jsxs)(N,{sx:{...$,width:500},children:[(0,K.jsx)(a,{variant:`h6`,component:`h2`,children:`ãƒ—ãƒ©ãƒ³å¤‰æ›´æ™‚ã®é€²æ—ã®æ‰±ã„ã‚’é¸æŠž`}),(0,K.jsx)(a,{sx:{mt:2},children:`ä»¥å‰ã®ãƒ—ãƒ©ãƒ³ã«ã¯å®Œäº†æ¸ˆã¿ã®ã‚µãƒ–ã‚¿ã‚¹ã‚¯ãŒå­˜åœ¨ã—ã¾ã™ã€‚æ–°ã—ã„ãƒ—ãƒ©ãƒ³ã«åˆ‡ã‚Šæ›¿ãˆã‚‹éš›ã«ã€ä»¥å‰ã®ãƒ—ãƒ©ãƒ³ã®é€²æ—ã‚’ã©ã†æ‰±ã„ã¾ã™ã‹ï¼Ÿ`}),(0,K.jsxs)(N,{sx:{mt:3,display:`flex`,justifyContent:`flex-end`,gap:1},children:[(0,K.jsx)(u,{variant:`outlined`,onClick:()=>{D(!1),A(null)},children:`ã‚­ãƒ£ãƒ³ã‚»ãƒ«`}),(0,K.jsx)(u,{variant:`outlined`,color:`primary`,onClick:()=>q(!1),children:`ã¯ã„ (é€²æ—ã‚’ç¶­æŒ)`}),(0,K.jsx)(u,{variant:`contained`,color:`error`,onClick:()=>q(!0),children:`ã¯ã„ (é€²æ—ã‚’ã‚¯ãƒªã‚¢)`})]})]})}),(0,K.jsx)(f,{open:b,onClose:()=>x(!1),children:(0,K.jsx)(N,{sx:We,children:(0,K.jsx)(m,{sx:{p:2,borderRadius:2,boxShadow:24,border:`2px solid #000`},children:(0,K.jsxs)(r,{spacing:2,children:[(0,K.jsx)(m,{variant:`outlined`,sx:{p:1,textAlign:`center`,letterSpacing:`0.5em`,fontSize:`1.4rem`,minHeight:`2.4rem`,overflow:`hidden`},children:S.replace(/./g,`*`)}),(0,K.jsx)(N,{sx:{display:`flex`,flexWrap:`wrap`,gap:1,width:240},children:ye.map((e,t)=>{let n=()=>{};return e.type===`num`&&(n=()=>_e(e.value.toString())),e.type===`clear`&&(n=ve),e.type===`bs`&&(n=Y),(0,K.jsx)(N,{sx:{flexBasis:`calc(33.333% - 8px)`,flexGrow:1},children:(0,K.jsx)(u,{fullWidth:!0,variant:`outlined`,onClick:n,sx:{height:`55px`,fontSize:`1.2rem`},children:e.value})},t)})})]})})})})]})}var qe=Ke;export{qe as default};