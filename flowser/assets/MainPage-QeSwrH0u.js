import{a as e,i as t,n,o as r,r as i,t as a}from"./geminiApiClient-C5GTObBY.js";import{a as o,n as s,r as c,s as l,t as u}from"./listItemTextClasses-OOEIqJM6.js";import{C as d,F as f,I as p,J as m,K as h,L as g,M as _,N as v,O as y,P as b,Q as x,S,V as C,W as w,X as T,Z as E,_ as D,a as O,at as k,c as A,ct as j,d as M,dt as N,et as P,f as F,ft as ee,g as I,ht as te,i as ne,it as L,j as R,k as z,l as re,lt as B,m as ie,mt as ae,n as V,nt as oe,o as se,ot as H,p as ce,pt as U,q as W,r as le,rt as ue,s as de,st as fe,t as pe,u as me,ut as he,vt as ge,w as G,yt as _e}from"./index-he-lcUqh.js";var K=_e(ge()),q=_e(te()),ve=j(),ye=ue(`div`,{name:`MuiStack`,slot:`Root`});function be(e){return oe({props:e,name:`MuiStack`,defaultTheme:ve})}function xe(e,t){let n=K.Children.toArray(e).filter(Boolean);return n.reduce((e,r,i)=>(e.push(r),i<n.length-1&&e.push(K.cloneElement(t,{key:`separator-${i}`})),e),[])}var Se=e=>({row:`Left`,"row-reverse":`Right`,column:`Top`,"column-reverse":`Bottom`})[e];const Ce=({ownerState:e,theme:t})=>{let n={display:`flex`,flexDirection:`column`,...N({theme:t},U({values:e.direction,breakpoints:t.breakpoints.values}),e=>({flexDirection:e}))};if(e.spacing){let r=B(t),i=Object.keys(t.breakpoints.values).reduce((t,n)=>((typeof e.spacing==`object`&&e.spacing[n]!=null||typeof e.direction==`object`&&e.direction[n]!=null)&&(t[n]=!0),t),{}),a=U({values:e.direction,base:i}),o=U({values:e.spacing,base:i});typeof a==`object`&&Object.keys(a).forEach((e,t,n)=>{a[e]||(a[e]=t>0?a[n[t-1]]:`column`)}),n=ae(n,N({theme:t},o,(t,n)=>e.useFlexGap?{gap:he(r,t)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${Se(n?a[n]:e.direction)}`]:he(r,t)}}))}return n=ee(t.breakpoints,n),n};function we(e={}){let{createStyledComponent:t=ye,useThemeProps:n=be,componentName:r=`MuiStack`}=e,i=()=>P({root:[`root`]},e=>k(r,e),{}),a=t(Ce);return K.forwardRef(function(e,t){let r=n(e),{component:o=`div`,direction:s=`column`,spacing:c=0,divider:l,children:u,className:d,useFlexGap:f=!1,...p}=fe(r),m={direction:s,spacing:c,useFlexGap:f},h=i();return(0,q.jsx)(a,{as:o,ownerState:m,ref:t,className:H(h.root,d),...p,children:l?xe(u,l):u})})}var Te=h((0,q.jsx)(`path`,{d:`M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z`}),`CheckBoxOutlineBlank`),Ee=h((0,q.jsx)(`path`,{d:`M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z`}),`CheckBox`),De=h((0,q.jsx)(`path`,{d:`M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z`}),`IndeterminateCheckBox`);function Oe(e){return k(`MuiCheckbox`,e)}var J=L(`MuiCheckbox`,[`root`,`checked`,`disabled`,`indeterminate`,`colorPrimary`,`colorSecondary`,`sizeSmall`,`sizeMedium`]),ke=e=>{let{classes:t,indeterminate:n,color:r,size:i}=e,a={root:[`root`,n&&`indeterminate`,`color${T(r)}`,`size${T(i)}`]},o=P(a,Oe,t);return{...t,...o}},Ae=E(l,{shouldForwardProp:e=>x(e)||e===`classes`,name:`MuiCheckbox`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.indeterminate&&t.indeterminate,t[`size${T(n.size)}`],n.color!==`default`&&t[`color${T(n.color)}`]]}})(m(({theme:e})=>({color:(e.vars||e).palette.text.secondary,variants:[{props:{color:`default`,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.active,(e.vars||e).palette.action.hoverOpacity)}}},...Object.entries(e.palette).filter(R()).map(([t])=>({props:{color:t,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.hoverOpacity)}}})),...Object.entries(e.palette).filter(R()).map(([t])=>({props:{color:t},style:{[`&.${J.checked}, &.${J.indeterminate}`]:{color:(e.vars||e).palette[t].main},[`&.${J.disabled}`]:{color:(e.vars||e).palette.action.disabled}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:`transparent`}}}}]}))),je=(0,q.jsx)(Ee,{}),Me=(0,q.jsx)(Te,{}),Ne=(0,q.jsx)(De,{}),Pe=K.forwardRef(function(e,t){let n=W({props:e,name:`MuiCheckbox`}),{checkedIcon:r=je,color:i=`primary`,icon:a=Me,indeterminate:o=!1,indeterminateIcon:s=Ne,inputProps:c,size:l=`medium`,disableRipple:u=!1,className:d,slots:f={},slotProps:m={},...h}=n,g=o?s:a,_=o?s:r,y={...n,disableRipple:u,color:i,indeterminate:o,size:l},b=ke(y),x=m.input??c,[S,C]=v(`root`,{ref:t,elementType:Ae,className:H(b.root,d),shouldForwardComponentProp:!0,externalForwardedProps:{slots:f,slotProps:m,...h},ownerState:y,additionalProps:{type:`checkbox`,icon:K.cloneElement(g,{fontSize:g.props.fontSize??l}),checkedIcon:K.cloneElement(_,{fontSize:_.props.fontSize??l}),disableRipple:u,slots:f,slotProps:{input:p(typeof x==`function`?x(y):x,{"data-indeterminate":o})}}});return(0,q.jsx)(S,{...C,classes:b})});function Fe(e){return k(`MuiListItem`,e)}L(`MuiListItem`,[`root`,`container`,`dense`,`alignItemsFlexStart`,`divider`,`gutters`,`padding`,`secondaryAction`]);function Ie(e){return k(`MuiListItemButton`,e)}var Y=L(`MuiListItemButton`,[`root`,`focusVisible`,`dense`,`alignItemsFlexStart`,`disabled`,`divider`,`gutters`,`selected`]);const Le=(e,t)=>{let{ownerState:n}=e;return[t.root,n.dense&&t.dense,n.alignItems===`flex-start`&&t.alignItemsFlexStart,n.divider&&t.divider,!n.disableGutters&&t.gutters]};var Re=e=>{let{alignItems:t,classes:n,dense:r,disabled:i,disableGutters:a,divider:o,selected:s}=e,c=P({root:[`root`,r&&`dense`,!a&&`gutters`,o&&`divider`,i&&`disabled`,t===`flex-start`&&`alignItemsFlexStart`,s&&`selected`]},Ie,n);return{...n,...c}},ze=E(_,{shouldForwardProp:e=>x(e)||e===`classes`,name:`MuiListItemButton`,slot:`Root`,overridesResolver:Le})(m(({theme:e})=>({display:`flex`,flexGrow:1,justifyContent:`flex-start`,alignItems:`center`,position:`relative`,textDecoration:`none`,minWidth:0,boxSizing:`border-box`,textAlign:`left`,paddingTop:8,paddingBottom:8,transition:e.transitions.create(`background-color`,{duration:e.transitions.duration.shortest}),"&:hover":{textDecoration:`none`,backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:`transparent`}},[`&.${Y.selected}`]:{backgroundColor:e.alpha((e.vars||e).palette.primary.main,(e.vars||e).palette.action.selectedOpacity),[`&.${Y.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette.primary.main,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.focusOpacity}`)}},[`&.${Y.selected}:hover`]:{backgroundColor:e.alpha((e.vars||e).palette.primary.main,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`),"@media (hover: none)":{backgroundColor:e.alpha((e.vars||e).palette.primary.main,(e.vars||e).palette.action.selectedOpacity)}},[`&.${Y.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${Y.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},variants:[{props:({ownerState:e})=>e.divider,style:{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:`padding-box`}},{props:{alignItems:`flex-start`},style:{alignItems:`flex-start`}},{props:({ownerState:e})=>!e.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:e})=>e.dense,style:{paddingTop:4,paddingBottom:4}}]}))),X=K.forwardRef(function(e,t){let n=W({props:e,name:`MuiListItemButton`}),{alignItems:r=`center`,autoFocus:i=!1,component:a=`div`,children:o,dense:s=!1,disableGutters:c=!1,divider:l=!1,focusVisibleClassName:u,selected:d=!1,className:f,...p}=n,m=K.useContext(D),h=K.useMemo(()=>({dense:s||m.dense||!1,alignItems:r,disableGutters:c}),[r,m.dense,s,c]),_=K.useRef(null);C(()=>{i&&_.current&&_.current.focus()},[i]);let v={...n,alignItems:r,dense:h.dense,disableGutters:c,divider:l,selected:d},y=Re(v),b=g(_,t);return(0,q.jsx)(D.Provider,{value:h,children:(0,q.jsx)(ze,{ref:b,href:p.href||p.to,component:(p.href||p.to)&&a===`div`?`button`:a,focusVisibleClassName:H(y.focusVisible,u),ownerState:v,className:H(y.root,f),...p,classes:y,children:o})})});function Be(e){return k(`MuiListItemSecondaryAction`,e)}L(`MuiListItemSecondaryAction`,[`root`,`disableGutters`]);var Ve=e=>{let{disableGutters:t,classes:n}=e;return P({root:[`root`,t&&`disableGutters`]},Be,n)},He=E(`div`,{name:`MuiListItemSecondaryAction`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.disableGutters&&t.disableGutters]}})({position:`absolute`,right:16,top:`50%`,transform:`translateY(-50%)`,variants:[{props:({ownerState:e})=>e.disableGutters,style:{right:0}}]}),Ue=K.forwardRef(function(e,t){let n=W({props:e,name:`MuiListItemSecondaryAction`}),{className:r,...i}=n,a=K.useContext(D),o={...n,disableGutters:a.disableGutters},s=Ve(o);return(0,q.jsx)(He,{className:H(s.root,r),ownerState:o,ref:t,...i})});Ue.muiName=`ListItemSecondaryAction`;var We=Ue;const Ge=(e,t)=>{let{ownerState:n}=e;return[t.root,n.dense&&t.dense,n.alignItems===`flex-start`&&t.alignItemsFlexStart,n.divider&&t.divider,!n.disableGutters&&t.gutters,!n.disablePadding&&t.padding,n.hasSecondaryAction&&t.secondaryAction]};var Ke=e=>{let{alignItems:t,classes:n,dense:r,disableGutters:i,disablePadding:a,divider:o,hasSecondaryAction:s}=e;return P({root:[`root`,r&&`dense`,!i&&`gutters`,!a&&`padding`,o&&`divider`,t===`flex-start`&&`alignItemsFlexStart`,s&&`secondaryAction`],container:[`container`]},Fe,n)};const qe=E(`div`,{name:`MuiListItem`,slot:`Root`,overridesResolver:Ge})(m(({theme:e})=>({display:`flex`,justifyContent:`flex-start`,alignItems:`center`,position:`relative`,textDecoration:`none`,width:`100%`,boxSizing:`border-box`,textAlign:`left`,variants:[{props:({ownerState:e})=>!e.disablePadding,style:{paddingTop:8,paddingBottom:8}},{props:({ownerState:e})=>!e.disablePadding&&e.dense,style:{paddingTop:4,paddingBottom:4}},{props:({ownerState:e})=>!e.disablePadding&&!e.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:e})=>!e.disablePadding&&!!e.secondaryAction,style:{paddingRight:48}},{props:({ownerState:e})=>!!e.secondaryAction,style:{[`& > .${Y.root}`]:{paddingRight:48}}},{props:{alignItems:`flex-start`},style:{alignItems:`flex-start`}},{props:({ownerState:e})=>e.divider,style:{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:`padding-box`}},{props:({ownerState:e})=>e.button,style:{transition:e.transitions.create(`background-color`,{duration:e.transitions.duration.shortest}),"&:hover":{textDecoration:`none`,backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:`transparent`}}}},{props:({ownerState:e})=>e.hasSecondaryAction,style:{paddingRight:48}}]})));var Je=E(`li`,{name:`MuiListItem`,slot:`Container`})({position:`relative`}),Ye=K.forwardRef(function(e,t){let n=W({props:e,name:`MuiListItem`}),{alignItems:r=`center`,children:i,className:a,component:o,components:s={},componentsProps:c={},ContainerComponent:l=`li`,ContainerProps:{className:u,...d}={},dense:f=!1,disableGutters:p=!1,disablePadding:m=!1,divider:h=!1,secondaryAction:_,slotProps:v={},slots:y={},...x}=n,S=K.useContext(D),C=K.useMemo(()=>({dense:f||S.dense||!1,alignItems:r,disableGutters:p}),[r,S.dense,f,p]),T=K.useRef(null),E=K.Children.toArray(i),O=E.length&&w(E[E.length-1],[`ListItemSecondaryAction`]),k={...n,alignItems:r,dense:C.dense,disableGutters:p,disablePadding:m,divider:h,hasSecondaryAction:O},A=Ke(k),j=g(T,t),M=y.root||s.Root||qe,N=v.root||c.root||{},P={className:H(A.root,N.className,a),...x},F=o||`li`;return O?(F=!P.component&&!o?`div`:F,l===`li`&&(F===`li`?F=`div`:P.component===`li`&&(P.component=`div`)),(0,q.jsx)(D.Provider,{value:C,children:(0,q.jsxs)(Je,{as:l,className:H(A.container,u),ref:j,ownerState:k,...d,children:[(0,q.jsx)(M,{...N,...!b(M)&&{as:F,ownerState:{...k,...N.ownerState}},...P,children:E}),E.pop()]})})):(0,q.jsx)(D.Provider,{value:C,children:(0,q.jsxs)(M,{...N,as:F,ref:j,...!b(M)&&{ownerState:{...k,...N.ownerState}},...P,children:[E,_&&(0,q.jsx)(We,{children:_})]})})}),Xe=e=>{let{alignItems:t,classes:n}=e;return P({root:[`root`,t===`flex-start`&&`alignItemsFlexStart`]},c,n)},Ze=E(`div`,{name:`MuiListItemIcon`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.alignItems===`flex-start`&&t.alignItemsFlexStart]}})(m(({theme:e})=>({minWidth:56,color:(e.vars||e).palette.action.active,flexShrink:0,display:`inline-flex`,variants:[{props:{alignItems:`flex-start`},style:{marginTop:8}}]}))),Z=K.forwardRef(function(e,t){let n=W({props:e,name:`MuiListItemIcon`}),{className:r,...i}=n,a=K.useContext(D),o={...n,alignItems:a.alignItems},s=Xe(o);return(0,q.jsx)(Ze,{className:H(s.root,r),ownerState:o,ref:t,...i})}),Qe=e=>{let{classes:t,inset:n,primary:r,secondary:i,dense:a}=e;return P({root:[`root`,n&&`inset`,a&&`dense`,r&&i&&`multiline`],primary:[`primary`],secondary:[`secondary`]},u,t)},$e=E(`div`,{name:`MuiListItemText`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[{[`& .${s.primary}`]:t.primary},{[`& .${s.secondary}`]:t.secondary},t.root,n.inset&&t.inset,n.primary&&n.secondary&&t.multiline,n.dense&&t.dense]}})({flex:`1 1 auto`,minWidth:0,marginTop:4,marginBottom:4,[`.${z.root}:where(& .${s.primary})`]:{display:`block`},[`.${z.root}:where(& .${s.secondary})`]:{display:`block`},variants:[{props:({ownerState:e})=>e.primary&&e.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:e})=>e.inset,style:{paddingLeft:56}}]}),Q=K.forwardRef(function(e,t){let n=W({props:e,name:`MuiListItemText`}),{children:r,className:i,disableTypography:a=!1,inset:o=!1,primary:s,primaryTypographyProps:c,secondary:l,secondaryTypographyProps:u,slots:d={},slotProps:f={},...p}=n,{dense:m}=K.useContext(D),h=s??r,g=l,_={...n,disableTypography:a,inset:o,primary:!!h,secondary:!!g,dense:m},b=Qe(_),x={slots:d,slotProps:{primary:c,secondary:u,...f}},[S,C]=v(`root`,{className:H(b.root,i),elementType:$e,externalForwardedProps:{...x,...p},ownerState:_,ref:t}),[w,T]=v(`primary`,{className:b.primary,elementType:y,externalForwardedProps:x,ownerState:_}),[E,O]=v(`secondary`,{className:b.secondary,elementType:y,externalForwardedProps:x,ownerState:_});return h!=null&&h.type!==y&&!a&&(h=(0,q.jsx)(w,{variant:m?`body2`:`body1`,component:T?.variant?void 0:`span`,...T,children:h})),g!=null&&g.type!==y&&!a&&(g=(0,q.jsx)(E,{variant:`body2`,color:`textSecondary`,...O,children:g})),(0,q.jsxs)(S,{...C,children:[h,g]})}),et=we({createStyledComponent:E(`div`,{name:`MuiStack`,slot:`Root`}),useThemeProps:e=>W({props:e,name:`MuiStack`})}),tt=E(f)({padding:`16px`,height:`100%`,overflow:`auto`}),$={critical:{label:`要対応`,color:`error`},progress:{label:`対応中`,color:`warning`},success:{label:`完了`,color:`success`},new:{label:`新規`,color:`default`}};function nt({customers:t,selectedCustomerId:n,onSelectCustomer:r}){return(0,q.jsxs)(tt,{children:[(0,q.jsx)(y,{variant:`h6`,gutterBottom:!0,children:`顧客リスト`}),(0,q.jsx)(I,{children:t.map(t=>(0,q.jsxs)(X,{selected:n===t.id,onClick:()=>r(t.id),children:[(0,q.jsx)(Q,{primary:t.name,secondary:t.company}),$[t.status]&&(0,q.jsx)(e,{label:$[t.status].label,color:$[t.status].color,size:`small`})]},t.id))})]})}var rt=nt,it=h((0,q.jsx)(`path`,{d:`M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z`}),`KeyboardArrowUp`),at=h((0,q.jsx)(`path`,{d:`M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z`}),`KeyboardArrowDown`),ot=E(f)({padding:`16px`,flexShrink:0}),st={critical:{label:`要対応`,color:`error`},progress:{label:`対応中`,color:`warning`},success:{label:`完了`,color:`success`},new:{label:`新規`,color:`default`}};function ct({customer:t,assignedFlows:n,onUnassignFlow:i,onOpenModal:a}){let[s,c]=(0,K.useState)(!1);return t?(0,q.jsxs)(ot,{children:[(0,q.jsxs)(G,{sx:{display:`flex`,justifyContent:`space-between`,alignItems:`center`},children:[(0,q.jsx)(y,{variant:`h6`,children:`顧客詳細`}),(0,q.jsx)(r,{onClick:()=>c(!s),size:`small`,children:s?(0,q.jsx)(at,{}):(0,q.jsx)(it,{})})]}),!s&&(0,q.jsxs)(G,{sx:{mt:1},children:[(0,q.jsx)(y,{variant:`h5`,children:t.name}),(0,q.jsx)(y,{variant:`body1`,children:t.company}),st[t.status]&&(0,q.jsx)(e,{label:st[t.status].label,color:st[t.status].color,sx:{mt:1}}),(0,q.jsx)(o,{sx:{my:2}}),(0,q.jsx)(y,{variant:`subtitle2`,gutterBottom:!0,children:`割り当て済みフロー`}),(0,q.jsx)(G,{sx:{display:`flex`,flexWrap:`wrap`,gap:1,mb:2},children:n&&n.length>0?n.map(t=>(0,q.jsx)(e,{label:t.name,onDelete:()=>i(t.instanceId),color:`primary`,variant:`outlined`},t.instanceId)):(0,q.jsx)(y,{variant:`body2`,color:`text.secondary`,children:`(なし)`})}),(0,q.jsx)(d,{variant:`contained`,onClick:a,children:`業務フローを割り当て`})]})]}):(0,q.jsx)(ot,{children:(0,q.jsx)(y,{children:`顧客を選択してください`})})}var lt=ct,ut=h((0,q.jsx)(`path`,{d:`M2 12.5C2 9.46 4.46 7 7.5 7H18c2.21 0 4 1.79 4 4s-1.79 4-4 4H9.5C8.12 15 7 13.88 7 12.5S8.12 10 9.5 10H17v2H9.41c-.55 0-.55 1 0 1H18c1.1 0 2-.9 2-2s-.9-2-2-2H7.5C5.57 9 4 10.57 4 12.5S5.57 16 7.5 16H17v2H7.5C4.46 18 2 15.54 2 12.5`}),`Attachment`),dt=h((0,q.jsx)(`path`,{d:`m19 15-6 6-1.42-1.42L15.17 16H4V4h2v10h9.17l-3.59-3.58L13 9z`}),`SubdirectoryArrowRight`),ft=h((0,q.jsx)(`path`,{d:`m14 4 2.29 2.29-2.88 2.88 1.42 1.42 2.88-2.88L20 10V4zm-4 0H4v6l2.29-2.29 4.71 4.7V20h2v-8.41l-5.29-5.3z`}),`CallSplit`),pt=h([(0,q.jsx)(`path`,{d:`M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7-.25c.41 0 .75.34.75.75s-.34.75-.75.75-.75-.34-.75-.75.34-.75.75-.75M19 19H5V5h14z`},`0`),(0,q.jsx)(`path`,{d:`m15.08 11.03-2.12-2.12L7 14.86V17h2.1zm1.77-1.76c.2-.2.2-.51 0-.71l-1.41-1.41c-.2-.2-.51-.2-.71 0l-1.06 1.06 2.12 2.12z`},`1`)],`NoteAltOutlined`),mt=E(f)({padding:`16px`,display:`flex`,flexDirection:`column`,flexGrow:1,minHeight:0}),ht=E(`div`)({width:`28px`,height:`28px`,borderRadius:`50%`,border:`2px solid #e53935`,color:`#e53935`,display:`flex`,alignItems:`center`,justifyContent:`center`,fontWeight:`bold`,fontSize:`14px`,transform:`rotate(-10deg)`,fontFamily:`"Helvetica Neue", Arial, sans-serif`}),gt=e=>e.type===`nested_branch`?e.selectedOption?e.options[e.selectedOption].tasks.every(e=>gt(e)):!1:e.completed,_t=({task:t,selectedTaskId:n,onSelectTask:r,level:i=0})=>{let a=gt(t);return(0,q.jsxs)(K.Fragment,{children:[(0,q.jsx)(Ye,{disablePadding:!0,sx:{pl:i*2},children:(0,q.jsxs)(X,{selected:n===t.id,onClick:()=>r(t.id),sx:{p:`4px 8px`},children:[(0,q.jsxs)(Z,{sx:{minWidth:40,height:28,alignItems:`center`,justifyContent:`center`},children:[i>0&&(0,q.jsx)(dt,{fontSize:`small`,color:`action`,sx:{mr:1}}),a?(0,q.jsx)(ht,{children:`済`}):(0,q.jsx)(G,{sx:{width:28}})]}),(0,q.jsx)(Q,{primary:t.text}),t.type===`nested_branch`&&(0,q.jsx)(Z,{sx:{minWidth:`auto`,mr:1,color:`text.secondary`},children:(0,q.jsx)(ft,{fontSize:`small`})}),t.type===`nested_branch`&&t.selectedOption&&(0,q.jsx)(e,{label:t.options[t.selectedOption].label,size:`small`,variant:`outlined`,sx:{mr:1}}),t.memo&&(0,q.jsx)(Z,{sx:{minWidth:`auto`,mr:1},children:(0,q.jsx)(pt,{fontSize:`small`,color:`action`})}),t.documents&&t.documents.length>0&&(0,q.jsx)(Z,{sx:{minWidth:`auto`},children:(0,q.jsx)(ut,{fontSize:`small`,color:`action`})})]})},t.id),t.type===`nested_branch`&&t.selectedOption&&t.options[t.selectedOption]&&t.options[t.selectedOption].tasks.map(e=>(0,q.jsx)(_t,{task:e,selectedTaskId:n,onSelectTask:r,level:i+1},e.id))]})};function vt({assignedFlows:e,selectedWorkflowId:n,onSelectWorkflow:r,currentWorkflow:a,onSelectTask:o,selectedTaskId:s}){return!e||e.length===0?(0,q.jsxs)(mt,{children:[(0,q.jsx)(y,{variant:`h6`,gutterBottom:!0,children:`🤖 業務フロー`}),(0,q.jsx)(G,{sx:{display:`flex`,alignItems:`center`,justifyContent:`center`,height:`100%`},children:(0,q.jsx)(y,{variant:`body2`,color:`text.secondary`,children:`この顧客には業務フローが割り当てられていません。`})})]}):(0,q.jsxs)(mt,{children:[(0,q.jsx)(y,{variant:`h6`,gutterBottom:!0,children:`🤖 業務フロー`}),(0,q.jsx)(G,{sx:{borderBottom:1,borderColor:`divider`,mb:1},children:(0,q.jsx)(i,{value:n||!1,onChange:(e,t)=>{r(t)},variant:`scrollable`,scrollButtons:`auto`,children:e.map(e=>(0,q.jsx)(t,{label:e.name,value:e.instanceId},e.instanceId))})}),(0,q.jsx)(G,{sx:{overflow:`auto`,flexGrow:1},children:a?(0,q.jsx)(I,{dense:!0,children:a.tasks.map(e=>(0,q.jsx)(_t,{task:e,selectedTaskId:s,onSelectTask:o},e.id))}):(0,q.jsx)(G,{sx:{display:`flex`,alignItems:`center`,justifyContent:`center`,height:`100%`},children:(0,q.jsx)(y,{variant:`body2`,color:`text.secondary`,children:`フローを選択してください。`})})})]})}var yt=vt,bt=h((0,q.jsx)(`path`,{d:`M18 15v3H6v-3H4v3c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-3zm-1-4-1.41-1.41L13 12.17V4h-2v8.17L8.41 9.59 7 11l5 5z`}),`FileDownloadOutlined`),xt=h((0,q.jsx)(`path`,{d:`M7.5 5.6 10 7 8.6 4.5 10 2 7.5 3.4 5 2l1.4 2.5L5 7zm12 9.8L17 14l1.4 2.5L17 19l2.5-1.4L22 19l-1.4-2.5L22 14zM22 2l-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5zm-7.63 5.29a.996.996 0 0 0-1.41 0L1.29 18.96c-.39.39-.39 1.02 0 1.41l2.34 2.34c.39.39 1.02.39 1.41 0L16.7 11.05c.39-.39.39-1.02 0-1.41zm-1.03 5.49-2.12-2.12 2.44-2.44 2.12 2.12z`}),`AutoFixHigh`),St=E(f)({padding:`16px`,height:`100%`,display:`flex`,flexDirection:`column`});function Ct({task:e,onToggleDocument:t,onToggleTask:n,onSelectBranch:i,onUpdateTaskMemo:s}){let c=F(),[l,u]=(0,K.useState)(``),[f,p]=(0,K.useState)(!1),[m,h]=(0,K.useState)(!1),{isApiCommunicating:g,selectedCustomerId:_,selectedWorkflowId:v}=ce(e=>e.workflow);return(0,K.useEffect)(()=>{e&&u(e.memo||``);let t=new a;p(t.isAvailable)},[e]),e?(0,q.jsxs)(St,{children:[(0,q.jsxs)(G,{children:[(0,q.jsx)(y,{variant:`h6`,children:e.text}),(0,q.jsx)(o,{sx:{my:1}}),e.type===`nested_branch`?(0,q.jsx)(G,{children:(0,q.jsxs)(et,{spacing:1,children:[(0,q.jsx)(y,{variant:`subtitle2`,children:`プランを選択してください:`}),Object.entries(e.options).map(([t,n])=>(0,q.jsx)(d,{variant:e.selectedOption===t?`contained`:`outlined`,onClick:()=>i(t),children:n.label},t))]})}):(0,q.jsxs)(X,{onClick:n,sx:{borderRadius:1,p:`4px 8px`},children:[(0,q.jsx)(Z,{sx:{minWidth:40},children:(0,q.jsx)(Pe,{edge:`start`,checked:!!e.completed,tabIndex:-1,disableRipple:!0})}),(0,q.jsx)(Q,{primary:`このタスクを完了済みにする`})]})]}),(0,q.jsx)(o,{sx:{my:1}}),(0,q.jsxs)(G,{sx:{overflow:`auto`,flexGrow:1},children:[(0,q.jsx)(y,{variant:`body1`,sx:{my:2,whiteSpace:`pre-wrap`},children:e.details}),(0,q.jsxs)(G,{sx:{my:2},children:[(0,q.jsxs)(G,{sx:{display:`flex`,justifyContent:`space-between`,alignItems:`center`,mb:1},children:[(0,q.jsx)(y,{variant:`subtitle2`,gutterBottom:!0,sx:{mb:0},children:`📝 タスクメモ`}),f&&(0,q.jsx)(d,{size:`small`,variant:`outlined`,startIcon:(0,q.jsx)(xt,{}),onClick:async()=>{if(!e||!l.trim()){alert(`メモ内容が空です。`);return}h(!0),c(le(!0));try{let t=new a,n=`あなたは優秀なアシスタントです。以下のタスク内容を踏まえ、メモの内容をより分かりやすく、簡潔に、かつ丁寧な言葉遣いに修正してください。\n\n# タスク内容\n${e.text}\n\n# メモの原文\n${l}\n\n# 指示\n- 修正後のメモのテキストだけを出力してください。\n- 挨拶や前置き、「修正後のメモ:」といった見出し、markdownの装飾などは一切含めないでください。`,r=await t.generateContent(n);c(de({task:e,customerId:_,workflowInstanceId:v,originalMemo:l,suggestion:r.trim()}))}catch(e){console.error(`AI memo refinement failed:`,e),alert(`AIによる整形に失敗しました: ${e.message}`),c(le(!1))}finally{h(!1)}},disabled:m||g,children:m||g?`処理中...`:`AI整形`})]}),(0,q.jsx)(ie,{fullWidth:!0,multiline:!0,rows:4,variant:`outlined`,placeholder:`このタスクに関するメモを入力...`,value:l,onChange:e=>u(e.target.value),onBlur:()=>{e&&e.memo!==l&&s(l)}})]}),e.documents&&e.documents.length>0&&(0,q.jsxs)(G,{sx:{mt:2},children:[(0,q.jsx)(y,{variant:`subtitle2`,gutterBottom:!0,children:`関連書類`}),(0,q.jsx)(I,{dense:!0,children:e.documents.map(e=>(0,q.jsx)(Ye,{disablePadding:!0,secondaryAction:(0,q.jsx)(r,{edge:`end`,href:e.url,target:`_blank`,sx:{right:`8px`},children:(0,q.jsx)(bt,{})}),children:(0,q.jsxs)(X,{onClick:()=>t&&t(e.name),sx:{pr:`48px`},children:[(0,q.jsx)(Z,{children:(0,q.jsx)(Pe,{edge:`start`,checked:e.checked,tabIndex:-1,disableRipple:!0})}),(0,q.jsx)(Q,{primary:e.name})]})},e.name))})]})]})]}):(0,q.jsx)(St,{children:(0,q.jsx)(G,{sx:{display:`flex`,alignItems:`center`,justifyContent:`center`,height:`100%`},children:(0,q.jsx)(y,{variant:`body2`,color:`text.secondary`,children:`中央のリストからタスクを選択してください。`})})})}var wt=Ct,Tt=h((0,q.jsx)(`path`,{d:`M22 3H7c-.69 0-1.23.35-1.59.88L0 12l5.41 8.11c.36.53.9.89 1.59.89h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H7.07L2.4 12l4.66-7H22zm-11.59-2L14 13.41 17.59 17 19 15.59 15.41 12 19 8.41 17.59 7 14 10.59 10.41 7 9 8.41 12.59 12 9 15.59z`}),`BackspaceOutlined`),Et=h((0,q.jsx)(`path`,{d:`M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z`}),`Clear`),Dt={position:`absolute`,top:`50%`,left:`50%`,transform:`translate(-50%, -50%)`,width:600,bgcolor:`background.paper`,border:`2px solid #000`,boxShadow:24,p:4},Ot={position:`absolute`,top:`50%`,left:`50%`,transform:`translate(-50%, -50%)`},kt=`1234`;function At(){let e=F(),{customerData:t,workflowLibrary:r,selectedCustomerId:i,selectedWorkflowId:a,selectedTaskId:o}=ce(e=>e.workflow),[s,c]=(0,K.useState)(!1),[l,u]=(0,K.useState)(()=>JSON.parse(localStorage.getItem(`isCustomerListLocked`))||!1),[p,m]=(0,K.useState)(!1),[h,g]=(0,K.useState)(!1),[_,v]=(0,K.useState)(``),[b,x]=(0,K.useState)(!1),[C,w]=(0,K.useState)(null);(0,K.useEffect)(()=>{localStorage.setItem(`isCustomerListLocked`,JSON.stringify(l))},[l]);let T=(0,K.useCallback)(()=>{JSON.parse(localStorage.getItem(`securityMode`))&&document.visibilityState===`hidden`&&!l&&u(!0)},[l]);(0,K.useEffect)(()=>(document.addEventListener(`visibilitychange`,T),()=>document.removeEventListener(`visibilitychange`,T)),[T]);let E=(0,K.useMemo)(()=>t.find(e=>e.id===i),[t,i]),D=(0,K.useMemo)(()=>E?.assignedWorkflows||[],[E]),k=(0,K.useMemo)(()=>!D||D.length===0?null:D.some(e=>e.instanceId===a)?a:D[0]?.instanceId||null,[D,a]);(0,K.useEffect)(()=>{k!==a&&e(se(k))},[k,a,e]);let j=(0,K.useMemo)(()=>D.find(e=>e.instanceId===k),[D,k]);(0,K.useEffect)(()=>{if(j&&j.tasks.length>0){let t=(e,n)=>{for(let r of e)if(r.id===n||r.type===`nested_branch`&&r.selectedOption&&r.options[r.selectedOption]&&t(r.options[r.selectedOption].tasks,n))return!0;return!1};if(!(o&&t(j.tasks,o))){let t=j.tasks[0];t&&e(O(t.id))}}else o!==null&&e(O(null))},[j,o,e]);let N=(0,K.useMemo)(()=>{if(!o||!j)return null;let e=(t,n)=>{for(let r of t){if(r.id===n)return r;if(r.type===`nested_branch`&&r.selectedOption&&r.options[r.selectedOption]){let t=e(r.options[r.selectedOption].tasks||[],n);if(t)return t}}return null};return e(j.tasks,o)},[o,j]),P=t=>{e(pe({customerId:i,workflowTemplateId:t})),c(!1)},ee=t=>{e(me({customerId:i,workflowInstanceId:t}))},te=(t,n)=>{e(M({customerId:i,workflowInstanceId:k,taskId:t,memo:n}))},L=t=>{e(re({customerId:i,workflowInstanceId:k,taskId:t}))},R=(t,n)=>{e(A({customerId:i,workflowInstanceId:k,taskId:t,docName:n}))},z=(t,n)=>{let r=localStorage.getItem(`branchResetBehavior`)||`confirm`;if(!j)return;let a=null,o=(e,t)=>{for(let n of e){if(n.id===t)return n;if(n.type===`nested_branch`&&n.options)for(let e in n.options){let r=o(n.options[e].tasks||[],t);if(r)return r}}return null};if(a=o(j.tasks,t),!a)return;if(!(a.selectedOption&&a.selectedOption!==n)){e(V({customerId:i,workflowInstanceId:k,taskId:t,optionKey:n,shouldReset:!1}));return}let s=a.selectedOption,c=s&&a.options[s]?.tasks||[],l=e=>{for(let t of e)if(t.completed||t.type===`nested_branch`&&t.selectedOption&&l(t.options[t.selectedOption].tasks||[]))return!0;return!1};if(!l(c)||r===`keep`){e(V({customerId:i,workflowInstanceId:k,taskId:t,optionKey:n,shouldReset:!1}));return}if(r===`clear`){e(V({customerId:i,workflowInstanceId:k,taskId:t,optionKey:n,shouldReset:!0}));return}w({taskId:t,newOptionKey:n}),x(!0)},B=t=>{if(C){let{taskId:n,newOptionKey:r}=C;e(V({customerId:i,workflowInstanceId:k,taskId:n,optionKey:r,shouldReset:t}))}x(!1),w(null)},ie=()=>{l?(v(``),g(!0)):m(!0)},ae=()=>{u(!0),m(!1)},oe=e=>v(t=>t+e),H=()=>v(e=>e.slice(0,-1)),U=()=>v(``);(0,K.useEffect)(()=>{_===kt&&(u(!1),g(!1),v(``))},[_]);let W=[{type:`num`,value:1},{type:`num`,value:2},{type:`num`,value:3},{type:`num`,value:4},{type:`num`,value:5},{type:`num`,value:6},{type:`num`,value:7},{type:`num`,value:8},{type:`num`,value:9},{type:`clear`,value:(0,q.jsx)(Et,{})},{type:`num`,value:0},{type:`bs`,value:(0,q.jsx)(Tt,{})}];return(0,q.jsxs)(G,{sx:{display:`flex`,flexDirection:`column`,height:`100vh`,bgcolor:`background.default`},children:[(0,q.jsx)(G,{sx:{p:`0 24px`},children:(0,q.jsx)(n,{isLocked:l,onToggleLock:ie})}),(0,q.jsxs)(G,{sx:{flexGrow:1,p:`0 24px 24px 24px`,display:`flex`,gap:2,minHeight:0},children:[!l&&(0,q.jsx)(G,{sx:{flex:`0 1 320px`,minWidth:280,transition:`all 0.3s ease`},children:(0,q.jsx)(rt,{customers:t,selectedCustomerId:i,onSelectCustomer:t=>e(ne(t))})}),(0,q.jsxs)(G,{sx:{flex:`1 1 50%`,display:`flex`,flexDirection:`column`,gap:2,minHeight:`fit-content`,minWidth:400},children:[(0,q.jsx)(lt,{customer:E,assignedFlows:D,onUnassignFlow:ee,onOpenModal:()=>c(!0)}),(0,q.jsx)(yt,{assignedFlows:D,selectedWorkflowId:k,onSelectWorkflow:t=>e(se(t)),currentWorkflow:j,onSelectTask:t=>e(O(t)),selectedTaskId:o})]}),(0,q.jsx)(G,{sx:{flex:`0 1 35%`,minWidth:320},children:(0,q.jsx)(wt,{task:N,onUpdateTaskMemo:e=>N&&te(N.id,e),onToggleTask:()=>N&&L(N.id),onSelectBranch:e=>N&&z(N.id,e),onToggleDocument:e=>N&&R(N.id,e)},N?`${k}-${o}`:`no-task-selected`)})]}),(0,q.jsx)(S,{open:s,onClose:()=>c(!1),children:(0,q.jsxs)(G,{sx:Dt,children:[(0,q.jsx)(y,{variant:`h6`,component:`h2`,gutterBottom:!0,children:`業務フローを選択`}),(0,q.jsx)(I,{children:r.map(e=>(0,q.jsx)(X,{onClick:()=>P(e.id),disabled:D.some(t=>t.templateId===e.id),children:(0,q.jsx)(Q,{primary:e.name,secondary:e.description})},e.id))})]})}),(0,q.jsx)(S,{open:p,onClose:()=>m(!1),children:(0,q.jsxs)(G,{sx:Dt,style:{width:400},children:[(0,q.jsx)(y,{variant:`h6`,component:`h2`,children:`顧客リストをロックしますか？`}),(0,q.jsx)(y,{sx:{mt:2},children:`ロックすると、パスコードを入力するまでリストは表示されません。`}),(0,q.jsxs)(G,{sx:{mt:3,display:`flex`,justifyContent:`flex-end`,gap:1},children:[(0,q.jsx)(d,{variant:`outlined`,onClick:()=>m(!1),children:`キャンセル`}),(0,q.jsx)(d,{variant:`contained`,color:`primary`,onClick:ae,children:`リストをロック`})]})]})}),(0,q.jsx)(S,{open:b,onClose:()=>{x(!1),w(null)},children:(0,q.jsxs)(G,{sx:{...Dt,width:500},children:[(0,q.jsx)(y,{variant:`h6`,component:`h2`,children:`プラン変更時の進捗の扱いを選択`}),(0,q.jsx)(y,{sx:{mt:2},children:`以前のプランには完了済みのサブタスクが存在します。新しいプランに切り替える際に、以前のプランの進捗をどう扱いますか？`}),(0,q.jsxs)(G,{sx:{mt:3,display:`flex`,justifyContent:`flex-end`,gap:1},children:[(0,q.jsx)(d,{variant:`outlined`,onClick:()=>{x(!1),w(null)},children:`キャンセル`}),(0,q.jsx)(d,{variant:`outlined`,color:`primary`,onClick:()=>B(!1),children:`はい (進捗を維持)`}),(0,q.jsx)(d,{variant:`contained`,color:`error`,onClick:()=>B(!0),children:`はい (進捗をクリア)`})]})]})}),(0,q.jsx)(S,{open:h,onClose:()=>g(!1),children:(0,q.jsx)(G,{sx:Ot,children:(0,q.jsx)(f,{sx:{p:2,borderRadius:2,boxShadow:24,border:`2px solid #000`},children:(0,q.jsxs)(et,{spacing:2,children:[(0,q.jsx)(f,{variant:`outlined`,sx:{p:1,textAlign:`center`,letterSpacing:`0.5em`,fontSize:`1.4rem`,minHeight:`2.4rem`,overflow:`hidden`},children:_.replace(/./g,`*`)}),(0,q.jsx)(G,{sx:{display:`flex`,flexWrap:`wrap`,gap:1,width:240},children:W.map((e,t)=>{let n=()=>{};return e.type===`num`&&(n=()=>oe(e.value.toString())),e.type===`clear`&&(n=U),e.type===`bs`&&(n=H),(0,q.jsx)(G,{sx:{flexBasis:`calc(33.333% - 8px)`,flexGrow:1},children:(0,q.jsx)(d,{fullWidth:!0,variant:`outlined`,onClick:n,sx:{height:`55px`,fontSize:`1.2rem`},children:e.value})},t)})})]})})})})]})}var jt=At;export{jt as default};