import{a as e,i as t,n,o as r,r as i,t as a}from"./AutoFixHigh-CSwLACJy.js";import{C as o,D as s,N as c,S as l,T as u,_ as d,a as f,g as p,i as m,k as h,l as g,m as _,r as v,t as y,z as b}from"./Header-D2_cX4r4.js";import{i as x,t as S}from"./geminiApiClient-CLzk0lO9.js";import{n as C,t as w}from"./ListItemText-Dkw5h1Xs.js";import{$ as T,A as ee,D as E,E as D,F as O,J as te,Lt as k,M as A,N as ne,O as j,Ot as M,P as N,Q as P,R as re,T as ie,Vt as F,Y as I,Z as L,_t as R,gt as z,it as B,j as V,k as ae,lt as H,nt as U,q as oe,rt as W,vt as se,w as ce}from"./index-DfSAp0TU.js";var G=F(k()),K=F(M()),le=b((0,K.jsx)(`path`,{d:`M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z`}),`CheckBoxOutlineBlank`),ue=b((0,K.jsx)(`path`,{d:`M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z`}),`CheckBox`),de=b((0,K.jsx)(`path`,{d:`M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z`}),`IndeterminateCheckBox`);function fe(e){return R(`MuiCheckbox`,e)}var q=z(`MuiCheckbox`,[`root`,`checked`,`disabled`,`indeterminate`,`colorPrimary`,`colorSecondary`,`sizeSmall`,`sizeMedium`]),J=e=>{let{classes:t,indeterminate:n,color:r,size:i}=e,a={root:[`root`,n&&`indeterminate`,`color${U(r)}`,`size${U(i)}`]},o=H(a,fe,t);return{...t,...o}},pe=W(x,{shouldForwardProp:e=>B(e)||e===`classes`,name:`MuiCheckbox`,slot:`Root`,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.indeterminate&&t.indeterminate,t[`size${U(n.size)}`],n.color!==`default`&&t[`color${U(n.color)}`]]}})(T(({theme:e})=>({color:(e.vars||e).palette.text.secondary,variants:[{props:{color:`default`,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.active,(e.vars||e).palette.action.hoverOpacity)}}},...Object.entries(e.palette).filter(L()).map(([t])=>({props:{color:t,disableRipple:!1},style:{"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.hoverOpacity)}}})),...Object.entries(e.palette).filter(L()).map(([t])=>({props:{color:t},style:{[`&.${q.checked}, &.${q.indeterminate}`]:{color:(e.vars||e).palette[t].main},[`&.${q.disabled}`]:{color:(e.vars||e).palette.action.disabled}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:`transparent`}}}}]}))),Y=(0,K.jsx)(ue,{}),me=(0,K.jsx)(le,{}),he=(0,K.jsx)(de,{}),X=G.forwardRef(function(e,t){let n=P({props:e,name:`MuiCheckbox`}),{checkedIcon:r=Y,color:i=`primary`,icon:a=me,indeterminate:o=!1,indeterminateIcon:l=he,inputProps:u,size:d=`medium`,disableRipple:f=!1,className:p,slots:m={},slotProps:h={},...g}=n,_=o?l:a,v=o?l:r,y={...n,disableRipple:f,color:i,indeterminate:o,size:d},b=J(y),x=h.input??u,[S,C]=s(`root`,{ref:t,elementType:pe,className:se(b.root,p),shouldForwardComponentProp:!0,externalForwardedProps:{slots:m,slotProps:h,...g},ownerState:y,additionalProps:{type:`checkbox`,icon:G.cloneElement(_,{fontSize:_.props.fontSize??d}),checkedIcon:G.cloneElement(v,{fontSize:v.props.fontSize??d}),disableRipple:f,slots:m,slotProps:{input:c(typeof x==`function`?x(y):x,{"data-indeterminate":o})}}});return(0,K.jsx)(S,{...C,classes:b})}),ge=W(h)({padding:`16px`,height:`100%`,overflow:`auto`}),Z={critical:{label:`要対応`,color:`error`},progress:{label:`対応中`,color:`warning`},success:{label:`完了`,color:`success`},new:{label:`新規`,color:`default`}};function _e({customers:t,selectedCustomerId:n,onSelectCustomer:r}){return(0,K.jsxs)(ge,{children:[(0,K.jsx)(o,{variant:`h6`,gutterBottom:!0,children:`顧客リスト`}),(0,K.jsx)(g,{children:t.map(t=>(0,K.jsxs)(e,{selected:n===t.id,onClick:()=>r(t.id),children:[(0,K.jsx)(w,{primary:t.name,secondary:t.company}),Z[t.status]&&(0,K.jsx)(l,{label:Z[t.status].label,color:Z[t.status].color,size:`small`})]},t.id))})]})}var ve=_e,ye=b((0,K.jsx)(`path`,{d:`M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z`}),`KeyboardArrowUp`),be=b((0,K.jsx)(`path`,{d:`M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z`}),`KeyboardArrowDown`),xe=W(h)({padding:`16px`,flexShrink:0}),Q={critical:{label:`要対応`,color:`error`},progress:{label:`対応中`,color:`warning`},success:{label:`完了`,color:`success`},new:{label:`新規`,color:`default`}};function Se({customer:e,assignedCases:t,onUnassignCase:n,onOpenModal:r}){let[i,a]=(0,G.useState)(!1);return e?(0,K.jsxs)(xe,{children:[(0,K.jsxs)(I,{sx:{display:`flex`,justifyContent:`space-between`,alignItems:`center`},children:[(0,K.jsx)(o,{variant:`h6`,children:`顧客詳細`}),(0,K.jsx)(u,{onClick:()=>a(!i),size:`small`,children:i?(0,K.jsx)(be,{}):(0,K.jsx)(ye,{})})]}),!i&&(0,K.jsxs)(I,{sx:{mt:1},children:[(0,K.jsx)(o,{variant:`h5`,children:e.name}),(0,K.jsx)(o,{variant:`body1`,children:e.company}),Q[e.status]&&(0,K.jsx)(l,{label:Q[e.status].label,color:Q[e.status].color,sx:{mt:1}}),(0,K.jsx)(_,{sx:{my:2}}),(0,K.jsx)(o,{variant:`subtitle2`,gutterBottom:!0,children:`割り当て済みケース`}),(0,K.jsx)(I,{sx:{display:`flex`,flexWrap:`wrap`,gap:1,mb:2},children:t&&t.length>0?t.map(e=>(0,K.jsx)(l,{label:e.name,onDelete:()=>n(e.instanceId),color:`primary`,variant:`outlined`},e.instanceId)):(0,K.jsx)(o,{variant:`body2`,color:`text.secondary`,children:`(なし)`})}),(0,K.jsx)(d,{variant:`contained`,onClick:r,children:`ケースを割り当て`})]})]}):(0,K.jsx)(xe,{children:(0,K.jsx)(o,{children:`顧客を選択してください`})})}var Ce=Se,we=b((0,K.jsx)(`path`,{d:`M2 12.5C2 9.46 4.46 7 7.5 7H18c2.21 0 4 1.79 4 4s-1.79 4-4 4H9.5C8.12 15 7 13.88 7 12.5S8.12 10 9.5 10H17v2H9.41c-.55 0-.55 1 0 1H18c1.1 0 2-.9 2-2s-.9-2-2-2H7.5C5.57 9 4 10.57 4 12.5S5.57 16 7.5 16H17v2H7.5C4.46 18 2 15.54 2 12.5`}),`Attachment`),Te=b((0,K.jsx)(`path`,{d:`m19 15-6 6-1.42-1.42L15.17 16H4V4h2v10h9.17l-3.59-3.58L13 9z`}),`SubdirectoryArrowRight`),Ee=b([(0,K.jsx)(`path`,{d:`M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7-.25c.41 0 .75.34.75.75s-.34.75-.75.75-.75-.34-.75-.75.34-.75.75-.75M19 19H5V5h14z`},`0`),(0,K.jsx)(`path`,{d:`m15.08 11.03-2.12-2.12L7 14.86V17h2.1zm1.77-1.76c.2-.2.2-.51 0-.71l-1.41-1.41c-.2-.2-.51-.2-.71 0l-1.06 1.06 2.12 2.12z`},`1`)],`NoteAltOutlined`),De=W(h)({padding:`16px`,display:`flex`,flexDirection:`column`,flexGrow:1,minHeight:0}),Oe=W(`div`)({width:`28px`,height:`28px`,borderRadius:`50%`,border:`2px solid #e53935`,color:`#e53935`,display:`flex`,alignItems:`center`,justifyContent:`center`,fontWeight:`bold`,fontSize:`14px`,transform:`rotate(-10deg)`,fontFamily:`"Helvetica Neue", Arial, sans-serif`}),ke=e=>e.type===`nested_branch`?e.selectedOption?e.options[e.selectedOption].tasks.every(e=>ke(e)):!1:e.completed,Ae=({task:r,selectedTaskId:i,onSelectTask:a,level:o=0})=>{let s=ke(r);return(0,K.jsxs)(G.Fragment,{children:[(0,K.jsx)(C,{disablePadding:!0,sx:{pl:o*2},children:(0,K.jsxs)(e,{selected:i===r.id,onClick:()=>a(r.id),sx:{p:`4px 8px`},children:[(0,K.jsxs)(t,{sx:{minWidth:40,height:28,alignItems:`center`,justifyContent:`center`},children:[o>0&&(0,K.jsx)(Te,{fontSize:`small`,color:`action`,sx:{mr:1}}),s?(0,K.jsx)(Oe,{children:`済`}):(0,K.jsx)(I,{sx:{width:28}})]}),(0,K.jsx)(w,{primary:r.text}),r.type===`nested_branch`&&(0,K.jsx)(t,{sx:{minWidth:`auto`,mr:1,color:`text.secondary`},children:(0,K.jsx)(n,{fontSize:`small`})}),r.type===`nested_branch`&&r.selectedOption&&(0,K.jsx)(l,{label:r.options[r.selectedOption].label,size:`small`,variant:`outlined`,sx:{mr:1}}),r.memo&&(0,K.jsx)(t,{sx:{minWidth:`auto`,mr:1},children:(0,K.jsx)(Ee,{fontSize:`small`,color:`action`})}),r.documents&&r.documents.length>0&&(0,K.jsx)(t,{sx:{minWidth:`auto`},children:(0,K.jsx)(we,{fontSize:`small`,color:`action`})})]})},r.id),r.type===`nested_branch`&&r.selectedOption&&r.options[r.selectedOption]&&r.options[r.selectedOption].tasks.map(e=>(0,K.jsx)(Ae,{task:e,selectedTaskId:i,onSelectTask:a,level:o+1},e.id))]})};function je({assignedCases:e,selectedCaseId:t,onSelectCase:n,currentCase:r,onSelectTask:i,selectedTaskId:a}){return!e||e.length===0?(0,K.jsxs)(De,{children:[(0,K.jsx)(o,{variant:`h6`,gutterBottom:!0,children:`🤖 実行中ケース`}),(0,K.jsx)(I,{sx:{display:`flex`,alignItems:`center`,justifyContent:`center`,height:`100%`},children:(0,K.jsx)(o,{variant:`body2`,color:`text.secondary`,children:`この顧客には実行中のケースがありません。`})})]}):(0,K.jsxs)(De,{children:[(0,K.jsx)(o,{variant:`h6`,gutterBottom:!0,children:`🤖 実行中ケース`}),(0,K.jsx)(I,{sx:{borderBottom:1,borderColor:`divider`,mb:1},children:(0,K.jsx)(m,{value:t||!1,onChange:(e,t)=>{n(t)},variant:`scrollable`,scrollButtons:`auto`,children:e.map(e=>(0,K.jsx)(f,{label:e.name,value:e.instanceId},e.instanceId))})}),(0,K.jsx)(I,{sx:{overflow:`auto`,flexGrow:1},children:r?(0,K.jsx)(g,{dense:!0,children:r.tasks.map(e=>(0,K.jsx)(Ae,{task:e,selectedTaskId:a,onSelectTask:i},e.id))}):(0,K.jsx)(I,{sx:{display:`flex`,alignItems:`center`,justifyContent:`center`,height:`100%`},children:(0,K.jsx)(o,{variant:`body2`,color:`text.secondary`,children:`ケースを選択してください。`})})})]})}var Me=je,Ne=b((0,K.jsx)(`path`,{d:`M18 15v3H6v-3H4v3c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-3zm-1-4-1.41-1.41L13 12.17V4h-2v8.17L8.41 9.59 7 11l5 5z`}),`FileDownloadOutlined`),Pe=W(h)({padding:`16px`,height:`100%`,display:`flex`,flexDirection:`column`}),Fe=(e,t)=>{let n=(e,t)=>{for(let r=0;r<e.length;r++){let i=e[r];if(i.id===t)return r===e.length-1;if(i.type===`nested_branch`&&i.selectedOption){let e=i.options[i.selectedOption].tasks||[],r=n(e,t);if(r!==null)return r}}return null};return n(t,e.id)};function Ie({task:n,currentCase:s,flowLibrary:c,onToggleDocument:l,onToggleTask:f,onSelectBranch:p,onUpdateTaskMemo:m,onConcludeAndProceed:h}){let y=oe(),[b,x]=(0,G.useState)(``),[T,ee]=(0,G.useState)(!1),[E,D]=(0,G.useState)(!1),{isApiCommunicating:O,selectedCustomerId:k,selectedCaseId:ne}=te(e=>e.case);(0,G.useEffect)(()=>{n&&x(n.memo||``);let e=new S;ee(e.isAvailable)},[n]);let M=(0,G.useMemo)(()=>!n||!s||!s.tasks?!1:Fe(n,s.tasks),[n,s]),N=(0,G.useMemo)(()=>!s||!c?null:c.find(e=>e.id===s.templateId)?.joint||null,[s,c]);return n?(0,K.jsxs)(Pe,{children:[(0,K.jsxs)(I,{children:[(0,K.jsx)(o,{variant:`h6`,children:n.text}),(0,K.jsx)(_,{sx:{my:1}}),n.type===`nested_branch`?(0,K.jsx)(I,{children:(0,K.jsxs)(i,{spacing:1,children:[(0,K.jsx)(o,{variant:`subtitle2`,children:`プランを選択してください:`}),Object.entries(n.options).map(([e,t])=>(0,K.jsx)(d,{variant:n.selectedOption===e?`contained`:`outlined`,onClick:()=>p(e),children:t.label},e))]})}):(0,K.jsxs)(e,{onClick:f,sx:{borderRadius:1,p:`4px 8px`},children:[(0,K.jsx)(t,{sx:{minWidth:40},children:(0,K.jsx)(X,{edge:`start`,checked:!!n.completed,tabIndex:-1,disableRipple:!0})}),(0,K.jsx)(w,{primary:`このタスクを完了済みにする`})]})]}),(0,K.jsx)(_,{sx:{my:1}}),(0,K.jsxs)(I,{sx:{overflow:`auto`,flexGrow:1},children:[(0,K.jsx)(o,{variant:`body1`,sx:{my:2,whiteSpace:`pre-wrap`},children:n.details}),(0,K.jsxs)(I,{sx:{my:2},children:[(0,K.jsxs)(I,{sx:{display:`flex`,justifyContent:`space-between`,alignItems:`center`,mb:1},children:[(0,K.jsx)(o,{variant:`subtitle2`,gutterBottom:!0,sx:{mb:0},children:`📝 タスクメモ`}),T&&(0,K.jsx)(d,{size:`small`,variant:`outlined`,startIcon:(0,K.jsx)(a,{}),onClick:async()=>{if(!n||!b.trim()){alert(`メモ内容が空です。`);return}D(!0),y(j(!0));try{let e=new S,t=`あなたは優秀なアシスタントです。以下のタスク内容を踏まえ、メモの内容をより分かりやすく、簡潔に、かつ丁寧な言葉遣いに修正してください。\n\n# タスク内容\n${n.text}\n\n# メモの原文\n${b}\n\n# 指示\n- 修正後のメモのテキストだけを出力してください。\n- 挨拶や前置き、「修正後のメモ:」といった見出し、markdownの装飾などは一切含めないでください。`,r=await e.generateContent(t);y(A({task:n,customerId:k,caseInstanceId:ne,originalMemo:b,suggestion:r.trim()}))}catch(e){console.error(`AI memo refinement failed:`,e),alert(`AIによる整形に失敗しました: ${e.message}`),y(j(!1))}finally{D(!1)}},disabled:E||O,children:E||O?`処理中...`:`AI整形`})]}),(0,K.jsx)(v,{fullWidth:!0,multiline:!0,rows:4,variant:`outlined`,placeholder:`このタスクに関するメモを入力...`,value:b,onChange:e=>x(e.target.value),onBlur:()=>{n&&n.memo!==b&&m(b)}})]}),n.documents&&n.documents.length>0&&(0,K.jsxs)(I,{sx:{mt:2},children:[(0,K.jsx)(o,{variant:`subtitle2`,gutterBottom:!0,children:`関連書類`}),(0,K.jsx)(g,{dense:!0,children:n.documents.map(n=>(0,K.jsx)(C,{disablePadding:!0,secondaryAction:(0,K.jsx)(u,{edge:`end`,href:n.url,target:`_blank`,sx:{right:`8px`},children:(0,K.jsx)(Ne,{})}),children:(0,K.jsxs)(e,{onClick:()=>l&&l(n.name),sx:{pr:`48px`},children:[(0,K.jsx)(t,{children:(0,K.jsx)(X,{edge:`start`,checked:n.checked,tabIndex:-1,disableRipple:!0})}),(0,K.jsx)(w,{primary:n.name})]})},n.name))})]})]}),(()=>{if(!n?.completed||!M||!N)return null;if(N.type===`direct`&&N.nextFlowId){let e=c.find(e=>e.id===N.nextFlowId);return(0,K.jsxs)(I,{sx:{mt:2},children:[(0,K.jsx)(r,{severity:`info`,sx:{mb:1},children:`このケースは完了しました。次のプロセスに進んでください。`}),(0,K.jsxs)(d,{variant:`contained`,fullWidth:!0,onClick:()=>h(N.nextFlowId),children:[`「`,e?e.name:`次のフロー`,`」へ進む`]})]})}return N.type===`branching`&&N.branches?.length>0?(0,K.jsxs)(I,{sx:{mt:2},children:[(0,K.jsx)(r,{severity:`info`,sx:{mb:2},children:N.prompt||`次のアクションを選択してください。`}),(0,K.jsx)(i,{spacing:1,children:N.branches.map(e=>!e.nextFlowId||!e.label?null:(0,K.jsx)(d,{variant:`outlined`,onClick:()=>h(e.nextFlowId),children:e.label},e.id))})]}):null})()]}):(0,K.jsx)(Pe,{children:(0,K.jsx)(I,{sx:{display:`flex`,alignItems:`center`,justifyContent:`center`,height:`100%`},children:(0,K.jsx)(o,{variant:`body2`,color:`text.secondary`,children:`中央のリストからタスクを選択してください。`})})})}var Le=Ie,Re=b((0,K.jsx)(`path`,{d:`M22 3H7c-.69 0-1.23.35-1.59.88L0 12l5.41 8.11c.36.53.9.89 1.59.89h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H7.07L2.4 12l4.66-7H22zm-11.59-2L14 13.41 17.59 17 19 15.59 15.41 12 19 8.41 17.59 7 14 10.59 10.41 7 9 8.41 12.59 12 9 15.59z`}),`BackspaceOutlined`),ze=b((0,K.jsx)(`path`,{d:`M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z`}),`Clear`),$={position:`absolute`,top:`50%`,left:`50%`,transform:`translate(-50%, -50%)`,width:600,bgcolor:`background.paper`,border:`2px solid #000`,boxShadow:24,p:4},Be={position:`absolute`,top:`50%`,left:`50%`,transform:`translate(-50%, -50%)`},Ve=`1234`;function He(){let t=oe(),{customerData:n,flowLibrary:r,selectedCustomerId:a,selectedCaseId:s,selectedTaskId:c}=te(e=>e.case),[l,u]=(0,G.useState)(!1),[f,m]=(0,G.useState)(()=>JSON.parse(localStorage.getItem(`isCustomerListLocked`))||!1),[_,v]=(0,G.useState)(!1),[b,x]=(0,G.useState)(!1),[S,C]=(0,G.useState)(``),[T,k]=(0,G.useState)(!1),[A,j]=(0,G.useState)(null),[M,P]=(0,G.useState)(!1),[F,L]=(0,G.useState)(null);(0,G.useEffect)(()=>{localStorage.setItem(`isCustomerListLocked`,JSON.stringify(f))},[f]);let R=(0,G.useCallback)(()=>{JSON.parse(localStorage.getItem(`securityMode`))&&document.visibilityState===`hidden`&&!f&&m(!0)},[f]);(0,G.useEffect)(()=>(document.addEventListener(`visibilitychange`,R),()=>document.removeEventListener(`visibilitychange`,R)),[R]);let z=(0,G.useMemo)(()=>n.find(e=>e.id===a),[n,a]),B=(0,G.useMemo)(()=>z?.assignedCases||[],[z]),H=(0,G.useMemo)(()=>!B||B.length===0?null:B.some(e=>e.instanceId===s)?s:B.find(e=>e.status!==`completed`)?.instanceId||null,[B,s]);(0,G.useEffect)(()=>{H!==s&&t(ae(H))},[H,s,t]);let U=(0,G.useMemo)(()=>B.find(e=>e.instanceId===H),[B,H]);(0,G.useEffect)(()=>{if(U&&U.tasks.length>0){let e=(t,n)=>{for(let r of t)if(r.id===n||r.type===`nested_branch`&&r.selectedOption&&r.options[r.selectedOption]&&e(r.options[r.selectedOption].tasks,n))return!0;return!1};if(!(c&&e(U.tasks,c))){let e=U.tasks[0];e&&t(V(e.id))}}else c!==null&&t(V(null))},[U,c,t]);let W=(0,G.useMemo)(()=>{if(!c||!U)return null;let e=(t,n)=>{for(let r of t){if(r.id===n)return r;if(r.type===`nested_branch`&&r.selectedOption&&r.options[r.selectedOption]){let t=e(r.options[r.selectedOption].tasks||[],n);if(t)return t}}return null};return e(U.tasks,c)},[c,U]),se=e=>{t(ce({customerId:a,flowTemplateId:e})),u(!1)},le=e=>{t(O({customerId:a,caseInstanceId:e}))},ue=(e,n)=>{t(re({customerId:a,caseInstanceId:H,taskId:e,memo:n}))},de=e=>{t(N({customerId:a,caseInstanceId:H,taskId:e}))},fe=(e,n)=>{t(ne({customerId:a,caseInstanceId:H,taskId:e,docName:n}))},q=(e,n)=>{let r=localStorage.getItem(`branchResetBehavior`)||`confirm`;if(!U)return;let i=null,o=(e,t)=>{for(let n of e){if(n.id===t)return n;if(n.type===`nested_branch`&&n.options)for(let e in n.options){let r=o(n.options[e].tasks||[],t);if(r)return r}}return null};if(i=o(U.tasks,e),!i)return;if(!(i.selectedOption&&i.selectedOption!==n)){t(E({customerId:a,caseInstanceId:H,taskId:e,optionKey:n,shouldReset:!1}));return}let s=i.selectedOption,c=s&&i.options[s]?.tasks||[],l=e=>{for(let t of e)if(t.completed||t.type===`nested_branch`&&t.selectedOption&&l(t.options[t.selectedOption].tasks||[]))return!0;return!1};if(!l(c)||r===`keep`){t(E({customerId:a,caseInstanceId:H,taskId:e,optionKey:n,shouldReset:!1}));return}if(r===`clear`){t(E({customerId:a,caseInstanceId:H,taskId:e,optionKey:n,shouldReset:!0}));return}j({taskId:e,newOptionKey:n}),k(!0)},J=e=>{if(A){let{taskId:n,newOptionKey:r}=A;t(E({customerId:a,caseInstanceId:H,taskId:n,optionKey:r,shouldReset:e}))}k(!1),j(null)},pe=e=>{B.some(t=>t.templateId===e)?(L({nextFlowId:e}),P(!0)):t(ie({customerId:a,caseInstanceId:H,nextFlowId:e}))},Y=e=>{F&&t(e?ie({customerId:a,caseInstanceId:H,nextFlowId:F.nextFlowId}):D({customerId:a,caseInstanceId:H})),P(!1),L(null)},me=()=>{f?(C(``),x(!0)):v(!0)},he=()=>{m(!0),v(!1)},X=e=>C(t=>t+e),ge=()=>C(e=>e.slice(0,-1)),Z=()=>C(``);(0,G.useEffect)(()=>{S===Ve&&(m(!1),x(!1),C(``))},[S]);let _e=[{type:`num`,value:1},{type:`num`,value:2},{type:`num`,value:3},{type:`num`,value:4},{type:`num`,value:5},{type:`num`,value:6},{type:`num`,value:7},{type:`num`,value:8},{type:`num`,value:9},{type:`clear`,value:(0,K.jsx)(ze,{})},{type:`num`,value:0},{type:`bs`,value:(0,K.jsx)(Re,{})}];return(0,K.jsxs)(I,{sx:{display:`flex`,flexDirection:`column`,height:`100vh`,bgcolor:`background.default`},children:[(0,K.jsx)(I,{sx:{p:`0 24px`},children:(0,K.jsx)(y,{isLocked:f,onToggleLock:me})}),(0,K.jsxs)(I,{sx:{flexGrow:1,p:`0 24px 24px 24px`,display:`flex`,gap:2,minHeight:0},children:[!f&&(0,K.jsx)(I,{sx:{flex:`0 1 320px`,minWidth:280,transition:`all 0.3s ease`},children:(0,K.jsx)(ve,{customers:n,selectedCustomerId:a,onSelectCustomer:e=>t(ee(e))})}),(0,K.jsxs)(I,{sx:{flex:`1 1 50%`,display:`flex`,flexDirection:`column`,gap:2,minHeight:`fit-content`,minWidth:400},children:[(0,K.jsx)(Ce,{customer:z,assignedCases:B,onUnassignCase:le,onOpenModal:()=>u(!0)}),(0,K.jsx)(Me,{assignedCases:B,selectedCaseId:H,onSelectCase:e=>t(ae(e)),currentCase:U,onSelectTask:e=>t(V(e)),selectedTaskId:c})]}),(0,K.jsx)(I,{sx:{flex:`0 1 35%`,minWidth:320},children:(0,K.jsx)(Le,{task:W,currentCase:U,flowLibrary:r,onUpdateTaskMemo:e=>W&&ue(W.id,e),onToggleTask:()=>W&&de(W.id),onSelectBranch:e=>W&&q(W.id,e),onToggleDocument:e=>W&&fe(W.id,e),onConcludeAndProceed:pe},W?`${H}-${c}`:`no-task-selected`)})]}),(0,K.jsx)(p,{open:l,onClose:()=>u(!1),children:(0,K.jsxs)(I,{sx:$,children:[(0,K.jsx)(o,{variant:`h6`,component:`h2`,gutterBottom:!0,children:`フローを選択`}),(0,K.jsx)(g,{children:r.map(t=>(0,K.jsx)(e,{onClick:()=>se(t.id),disabled:B.some(e=>e.templateId===t.id),children:(0,K.jsx)(w,{primary:t.name,secondary:t.description})},t.id))})]})}),(0,K.jsx)(p,{open:_,onClose:()=>v(!1),children:(0,K.jsxs)(I,{sx:$,style:{width:400},children:[(0,K.jsx)(o,{variant:`h6`,component:`h2`,children:`顧客リストをロックしますか？`}),(0,K.jsx)(o,{sx:{mt:2},children:`ロックすると、パスコードを入力するまでリストは表示されません。`}),(0,K.jsxs)(I,{sx:{mt:3,display:`flex`,justifyContent:`flex-end`,gap:1},children:[(0,K.jsx)(d,{variant:`outlined`,onClick:()=>v(!1),children:`キャンセル`}),(0,K.jsx)(d,{variant:`contained`,color:`primary`,onClick:he,children:`リストをロック`})]})]})}),(0,K.jsx)(p,{open:M,onClose:()=>P(!1),children:(0,K.jsxs)(I,{sx:{...$,width:500},children:[(0,K.jsx)(o,{variant:`h6`,children:`プロセスの繰り返し確認`}),(0,K.jsx)(o,{sx:{mt:2},children:`この操作により、以前に実行したことのある業務プロセスが再度開始されます。 プロセスを繰り返しますか？それともここで全ての業務を完了しますか？`}),(0,K.jsxs)(I,{sx:{mt:3,display:`flex`,justifyContent:`flex-end`,gap:1},children:[(0,K.jsx)(d,{variant:`contained`,color:`primary`,onClick:()=>Y(!0),children:`繰り返す`}),(0,K.jsx)(d,{variant:`outlined`,onClick:()=>Y(!1),children:`完了する`})]})]})}),(0,K.jsx)(p,{open:T,onClose:()=>{k(!1),j(null)},children:(0,K.jsxs)(I,{sx:{...$,width:500},children:[(0,K.jsx)(o,{variant:`h6`,component:`h2`,children:`プラン変更時の進捗の扱いを選択`}),(0,K.jsx)(o,{sx:{mt:2},children:`以前のプランには完了済みのサブタスクが存在します。新しいプランに切り替える際に、以前のプランの進捗をどう扱いますか？`}),(0,K.jsxs)(I,{sx:{mt:3,display:`flex`,justifyContent:`flex-end`,gap:1},children:[(0,K.jsx)(d,{variant:`outlined`,onClick:()=>{k(!1),j(null)},children:`キャンセル`}),(0,K.jsx)(d,{variant:`outlined`,color:`primary`,onClick:()=>J(!1),children:`はい (進捗を維持)`}),(0,K.jsx)(d,{variant:`contained`,color:`error`,onClick:()=>J(!0),children:`はい (進捗をクリア)`})]})]})}),(0,K.jsx)(p,{open:b,onClose:()=>x(!1),children:(0,K.jsx)(I,{sx:Be,children:(0,K.jsx)(h,{sx:{p:2,borderRadius:2,boxShadow:24,border:`2px solid #000`},children:(0,K.jsxs)(i,{spacing:2,children:[(0,K.jsx)(h,{variant:`outlined`,sx:{p:1,textAlign:`center`,letterSpacing:`0.5em`,fontSize:`1.4rem`,minHeight:`2.4rem`,overflow:`hidden`},children:S.replace(/./g,`*`)}),(0,K.jsx)(I,{sx:{display:`flex`,flexWrap:`wrap`,gap:1,width:240},children:_e.map((e,t)=>{let n=()=>{};return e.type===`num`&&(n=()=>X(e.value.toString())),e.type===`clear`&&(n=Z),e.type===`bs`&&(n=ge),(0,K.jsx)(I,{sx:{flexBasis:`calc(33.333% - 8px)`,flexGrow:1},children:(0,K.jsx)(d,{fullWidth:!0,variant:`outlined`,onClick:n,sx:{height:`55px`,fontSize:`1.2rem`},children:e.value})},t)})})]})})})})]})}var Ue=He;export{Ue as default};